import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.0e8ae64e.js";const u=JSON.parse('{"title":"Cram Tests","description":"","frontmatter":{},"headers":[],"relativePath":"cram-tests/index.md","filePath":"cram-tests/index.md","lastUpdated":1716395778000}'),o={name:"cram-tests/index.md"},p=l(`<h1 id="cram-tests" tabindex="-1">Cram Tests <a class="header-anchor" href="#cram-tests" aria-label="Permalink to &quot;Cram Tests&quot;">​</a></h1><p>Now that you have a set of unit tests for sandwich-related logic, you realize it would be nice to have some unit tests for burger-related logic as well. But adding a new command to your <code>test</code> npm script doesn’t feel like The OCaml Way, so you hop on the <a href="https://melange.re/v4.0.0/community.html#community" target="_blank" rel="noreferrer">Reason Discord chatroom</a> to ask for advice. MonadicFanatic1984 once again comes to your aid and points you toward <em>cram tests</em>.</p><h2 id="cram-tests-1" tabindex="-1">Cram tests <a class="header-anchor" href="#cram-tests-1" aria-label="Permalink to &quot;Cram tests&quot;">​</a></h2><p>A <a href="https://dune.readthedocs.io/en/stable/reference/cram.html" target="_blank" rel="noreferrer">cram test</a> is essentially a test that runs a command inside a sandbox, then compares the output with some expected output. Dune has built-in support for cram tests, which means:</p><ul><li>You can specify dependencies for a cram test inside your <code>dune</code> file</li><li>Cram tests are only run when their dependencies change</li><li>When you update cram tests, causing their output to change, you can easily <em>promote</em> the latest output to become the new expected output</li><li>You can run all tests using a single command that doesn’t need to refer to individual tests</li></ul><h2 id="cram-stanza" tabindex="-1"><code>cram</code> stanza <a class="header-anchor" href="#cram-stanza" aria-label="Permalink to &quot;\`cram\` stanza&quot;">​</a></h2><p>To add dependencies for your cram tests, you need to add a <a href="https://dune.readthedocs.io/en/stable/dune-files.html#cram-stanza" target="_blank" rel="noreferrer">cram stanza</a> to <code>src/order-confirmation/dune</code>:</p><div class="language-dune vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dune</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">(cram</span></span>
<span class="line"><span style="color:#E1E4E8;"> (deps .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">output</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">src</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">order-confirmation</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">SandwichTests.mjs))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">(cram</span></span>
<span class="line"><span style="color:#24292E;"> (deps .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">output</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">src</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">order-confirmation</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">SandwichTests.mjs))</span></span></code></pre></div><p>This configuration tells Dune two things:</p><ul><li>Copy <code>./output/src/order-confirmation/SandwichTests.mjs</code> into the sandbox directory</li><li>Whenever <code>SandwichTests.re</code> (the immediate dependency for <code>./output/src/order-confirmation/SandwichTests.mjs</code>) changes, rebuild and re-run all the cram tests defined in the same directory as this <code>dune</code> file</li></ul><p>Note that we cannot use the same path to <code>SandwichTests.mjs</code> as we would if we were running this from the root directory of our project, because cram tests are run inside a sandbox directory (more on that later).</p><h2 id="add-tests-t-file" tabindex="-1">Add <code>tests.t</code> file <a class="header-anchor" href="#add-tests-t-file" aria-label="Permalink to &quot;Add \`tests.t\` file&quot;">​</a></h2><p>Cram tests are specified inside <code>.t</code> files. Add a new file <code>src/order-confirmation/tests.t</code>:</p><div class="language-cram vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cram</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">Sandwich tests</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;"> node ./output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">Sandwich tests</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">$</span><span style="color:#24292E;"> node ./output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre></div><p>Note that this is the same path for <code>SandwichTests.mjs</code> that we specified inside the <code>cram/deps</code> field.</p><p>To run tests, execute</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">dune</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@runtest</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">dune</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@runtest</span></span></code></pre></div><p>Here, <a href="https://dune.readthedocs.io/en/stable/reference/aliases.html#runtest" target="_blank" rel="noreferrer">@runtest</a> is a built-in <em>alias</em>. The above command builds whatever is needed by the tests and then runs the tests.</p><h2 id="aliases" tabindex="-1">Aliases <a class="header-anchor" href="#aliases" aria-label="Permalink to &quot;Aliases&quot;">​</a></h2><p>A Dune <a href="https://dune.readthedocs.io/en/stable/reference/aliases.html" target="_blank" rel="noreferrer">alias</a> is a virtual build target that other build targets can attach to. You can refer to aliases by name in build commands (like the one above), to build a specific subset of your build targets. In commands, we need to put <code>@</code> in front of the alias name to distinguish it from file names. Therefore when we refer to an alias, we put an <code>@</code> in front, e.g. <code>@runtest</code>, <code>@melange</code>, etc.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Cram tests are automatically attached to the <code>@runtest</code> alias, and <code>melange.emit</code> stanzas are automatically attached to the <code>@melange</code> alias.</p></div><h2 id="promotion" tabindex="-1">Promotion <a class="header-anchor" href="#promotion" aria-label="Permalink to &quot;Promotion&quot;">​</a></h2><p>After running <code>dune build @runtest</code>, you should be able to see the output from the cram test you just added<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;font-weight:bold;">@@ -1,2 +1,27 @@</span></span>
<span class="line"><span style="color:#E1E4E8;"> Sandwich tests</span></span>
<span class="line"><span style="color:#E1E4E8;">   $ node ./output/src/cram-tests/SandwichTests.mjs</span></span>
<span class="line"><span style="color:#85E89D;">+  TAP version 13</span></span>
<span class="line"><span style="color:#85E89D;">+  # Subtest: Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#85E89D;">+  ok 1 - Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#85E89D;">+    ---</span></span>
<span class="line"><span style="color:#85E89D;">+    duration_ms: 2.173649</span></span>
<span class="line"><span style="color:#85E89D;">+    ...</span></span>
<span class="line"><span style="color:#85E89D;">+  # Subtest: Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#85E89D;">+  ok 2 - Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#85E89D;">+    ---</span></span>
<span class="line"><span style="color:#85E89D;">+    duration_ms: 0.216146</span></span>
<span class="line"><span style="color:#85E89D;">+    ...</span></span>
<span class="line"><span style="color:#85E89D;">+  # Subtest: Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#85E89D;">+  ok 3 - Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#85E89D;">+    ---</span></span>
<span class="line"><span style="color:#85E89D;">+    duration_ms: 0.106589</span></span>
<span class="line"><span style="color:#85E89D;">+    ...</span></span>
<span class="line"><span style="color:#85E89D;">+  1..3</span></span>
<span class="line"><span style="color:#85E89D;">+  # tests 3</span></span>
<span class="line"><span style="color:#85E89D;">+  # suites 0</span></span>
<span class="line"><span style="color:#85E89D;">+  # pass 3</span></span>
<span class="line"><span style="color:#85E89D;">+  # fail 0</span></span>
<span class="line"><span style="color:#85E89D;">+  # cancelled 0</span></span>
<span class="line"><span style="color:#85E89D;">+  # skipped 0</span></span>
<span class="line"><span style="color:#85E89D;">+  # todo 0</span></span>
<span class="line"><span style="color:#85E89D;">+  # duration_ms 0.111087</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;font-weight:bold;">@@ -1,2 +1,27 @@</span></span>
<span class="line"><span style="color:#24292E;"> Sandwich tests</span></span>
<span class="line"><span style="color:#24292E;">   $ node ./output/src/cram-tests/SandwichTests.mjs</span></span>
<span class="line"><span style="color:#22863A;">+  TAP version 13</span></span>
<span class="line"><span style="color:#22863A;">+  # Subtest: Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#22863A;">+  ok 1 - Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#22863A;">+    ---</span></span>
<span class="line"><span style="color:#22863A;">+    duration_ms: 2.173649</span></span>
<span class="line"><span style="color:#22863A;">+    ...</span></span>
<span class="line"><span style="color:#22863A;">+  # Subtest: Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#22863A;">+  ok 2 - Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#22863A;">+    ---</span></span>
<span class="line"><span style="color:#22863A;">+    duration_ms: 0.216146</span></span>
<span class="line"><span style="color:#22863A;">+    ...</span></span>
<span class="line"><span style="color:#22863A;">+  # Subtest: Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#22863A;">+  ok 3 - Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#22863A;">+    ---</span></span>
<span class="line"><span style="color:#22863A;">+    duration_ms: 0.106589</span></span>
<span class="line"><span style="color:#22863A;">+    ...</span></span>
<span class="line"><span style="color:#22863A;">+  1..3</span></span>
<span class="line"><span style="color:#22863A;">+  # tests 3</span></span>
<span class="line"><span style="color:#22863A;">+  # suites 0</span></span>
<span class="line"><span style="color:#22863A;">+  # pass 3</span></span>
<span class="line"><span style="color:#22863A;">+  # fail 0</span></span>
<span class="line"><span style="color:#22863A;">+  # cancelled 0</span></span>
<span class="line"><span style="color:#22863A;">+  # skipped 0</span></span>
<span class="line"><span style="color:#22863A;">+  # todo 0</span></span>
<span class="line"><span style="color:#22863A;">+  # duration_ms 0.111087</span></span></code></pre></div><p>However, this doesn’t count as a passing cram test, because this output can’t be compared to any expected output. Dune has a nice feature that lets you <a href="https://dune.readthedocs.io/en/stable/concepts/promotion.html#promotion" target="_blank" rel="noreferrer">promote</a> the latest output of a cram test to become the expected output:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">dune</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">promote</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">dune</span><span style="color:#24292E;"> </span><span style="color:#032F62;">promote</span></span></code></pre></div><p>The above command updates your <code>src/order-confirmation/tests.t</code> cram test file, which now looks something like this:</p><div class="language-cram vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cram</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">Sandwich tests</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;"> node ./output/src/order-confirmation/SandwichTests.mjs</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">TAP version 13</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># Subtest: Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ok 1 - Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ---</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  duration_ms: 1.821041</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># Subtest: Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ok 2 - Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ---</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  duration_ms: 0.731916</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># Subtest: Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ok 3 - Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ---</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  duration_ms: 0.086875</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">1..3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># tests 3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># suites 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># pass 3</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># fail 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># cancelled 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># skipped 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># todo 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># duration_ms 0.081042</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">Sandwich tests</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">$</span><span style="color:#24292E;"> node ./output/src/order-confirmation/SandwichTests.mjs</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">TAP version 13</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># Subtest: Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">ok 1 - Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ---</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  duration_ms: 1.821041</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># Subtest: Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">ok 2 - Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ---</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  duration_ms: 0.731916</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># Subtest: Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">ok 3 - Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ---</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  duration_ms: 0.086875</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">1..3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># tests 3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># suites 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># pass 3</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># fail 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># cancelled 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># skipped 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># todo 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># duration_ms 0.081042</span></span></code></pre></div><p>The part underneath the command is the expected output of the command.</p><h2 id="add-npm-scripts" tabindex="-1">Add <code>npm</code> scripts <a class="header-anchor" href="#add-npm-scripts" aria-label="Permalink to &quot;Add \`npm\` scripts&quot;">​</a></h2><p>Instead of typing <code>dune</code> commands over and over, let’s add the relevant <code>npm</code> scripts to your <code>package.json</code> file. Replace the current <code>test</code> script with these three scripts:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&quot;test&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm run build -- @runtest&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;test:watch&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm run build -- @runtest --watch&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;promote&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;npm run dune -- promote&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">&quot;test&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;npm run build -- @runtest&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;test:watch&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;npm run build -- @runtest --watch&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;promote&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;npm run dune -- promote&quot;</span></span></code></pre></div><p>Since JSON doesn’t support comments, you can optionally add some lines to the <code>scriptsComments</code> section of <code>package.json</code> to explain what each command does:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#9ECBFF;">&quot;test&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;# Run the tests&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;test:watch&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;# Watch files and re-run tests&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#9ECBFF;">&quot;promote&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;# Promote most recent output to expected output&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#032F62;">&quot;test&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;# Run the tests&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;test:watch&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;# Watch files and re-run tests&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#032F62;">&quot;promote&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;# Promote most recent output to expected output&quot;</span></span></code></pre></div><p>Run <code>npm run test</code> to check that it works.</p><h2 id="sanitize-cram-test-output" tabindex="-1">Sanitize cram test output <a class="header-anchor" href="#sanitize-cram-test-output" aria-label="Permalink to &quot;Sanitize cram test output&quot;">​</a></h2><p>The cram test still doesn’t succeed, but now it’s because the most recent output and the expected output don’t match:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;font-weight:bold;">@@ -4,17 +4,17 @@</span><span style="color:#E1E4E8;"> Sandwich tests</span></span>
<span class="line"><span style="color:#E1E4E8;">   # Subtest: Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#E1E4E8;">   ok 1 - Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#E1E4E8;">     ---</span></span>
<span class="line"><span style="color:#FDAEB7;">-    duration_ms: 2.225448</span></span>
<span class="line"><span style="color:#85E89D;">+    duration_ms: 3.012631</span></span>
<span class="line"><span style="color:#E1E4E8;">     ...</span></span>
<span class="line"><span style="color:#E1E4E8;">   # Subtest: Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#E1E4E8;">   ok 2 - Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#E1E4E8;">     ---</span></span>
<span class="line"><span style="color:#FDAEB7;">-    duration_ms: 0.262691</span></span>
<span class="line"><span style="color:#85E89D;">+    duration_ms: 0.276333</span></span>
<span class="line"><span style="color:#E1E4E8;">     ...</span></span>
<span class="line"><span style="color:#E1E4E8;">   # Subtest: Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#E1E4E8;">   ok 3 - Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#E1E4E8;">     ---</span></span>
<span class="line"><span style="color:#FDAEB7;">-    duration_ms: 0.109477</span></span>
<span class="line"><span style="color:#85E89D;">+    duration_ms: 0.140118</span></span>
<span class="line"><span style="color:#E1E4E8;">     ...</span></span>
<span class="line"><span style="color:#E1E4E8;">   1..3</span></span>
<span class="line"><span style="color:#E1E4E8;">   # tests 3</span></span>
<span class="line"><span style="color:#B392F0;font-weight:bold;">@@ -24,4 +24,4 @@</span><span style="color:#E1E4E8;"> Sandwich tests</span></span>
<span class="line"><span style="color:#E1E4E8;">   # cancelled 0</span></span>
<span class="line"><span style="color:#E1E4E8;">   # skipped 0</span></span>
<span class="line"><span style="color:#E1E4E8;">   # todo 0</span></span>
<span class="line"><span style="color:#FDAEB7;">-  # duration_ms 0.125331</span></span>
<span class="line"><span style="color:#85E89D;">+  # duration_ms 0.143172</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;font-weight:bold;">@@ -4,17 +4,17 @@</span><span style="color:#24292E;"> Sandwich tests</span></span>
<span class="line"><span style="color:#24292E;">   # Subtest: Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#24292E;">   ok 1 - Item.Sandwich.toEmoji</span></span>
<span class="line"><span style="color:#24292E;">     ---</span></span>
<span class="line"><span style="color:#B31D28;">-    duration_ms: 2.225448</span></span>
<span class="line"><span style="color:#22863A;">+    duration_ms: 3.012631</span></span>
<span class="line"><span style="color:#24292E;">     ...</span></span>
<span class="line"><span style="color:#24292E;">   # Subtest: Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#24292E;">   ok 2 - Item.Sandwich.toPrice</span></span>
<span class="line"><span style="color:#24292E;">     ---</span></span>
<span class="line"><span style="color:#B31D28;">-    duration_ms: 0.262691</span></span>
<span class="line"><span style="color:#22863A;">+    duration_ms: 0.276333</span></span>
<span class="line"><span style="color:#24292E;">     ...</span></span>
<span class="line"><span style="color:#24292E;">   # Subtest: Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#24292E;">   ok 3 - Item.Sandwich.toPrice returns lower price for Turducken on Tuesdays</span></span>
<span class="line"><span style="color:#24292E;">     ---</span></span>
<span class="line"><span style="color:#B31D28;">-    duration_ms: 0.109477</span></span>
<span class="line"><span style="color:#22863A;">+    duration_ms: 0.140118</span></span>
<span class="line"><span style="color:#24292E;">     ...</span></span>
<span class="line"><span style="color:#24292E;">   1..3</span></span>
<span class="line"><span style="color:#24292E;">   # tests 3</span></span>
<span class="line"><span style="color:#6F42C1;font-weight:bold;">@@ -24,4 +24,4 @@</span><span style="color:#24292E;"> Sandwich tests</span></span>
<span class="line"><span style="color:#24292E;">   # cancelled 0</span></span>
<span class="line"><span style="color:#24292E;">   # skipped 0</span></span>
<span class="line"><span style="color:#24292E;">   # todo 0</span></span>
<span class="line"><span style="color:#B31D28;">-  # duration_ms 0.125331</span></span>
<span class="line"><span style="color:#22863A;">+  # duration_ms 0.143172</span></span></code></pre></div><p>The problem is that the recorded durations for individual unit tests is a little bit different on each test run. Therefore we must <a href="https://dune.readthedocs.io/en/stable/tests.html#test-output-sanitation" target="_blank" rel="noreferrer">sanitize</a> the test output, i.e. remove the parts that are non-deterministic. Update your cram test command:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">$</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">node</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">./output/src/order-confirmation/SandwichTests.mjs</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">sed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;/duration_ms/d&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">$</span><span style="color:#24292E;"> </span><span style="color:#032F62;">node</span><span style="color:#24292E;"> </span><span style="color:#032F62;">./output/src/order-confirmation/SandwichTests.mjs</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">sed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;/duration_ms/d&#39;</span></span></code></pre></div><p>Now the output of the command is piped to <code>sed &#39;/duration_ms/d&#39;</code>, which removes all the lines containing the string <code>duration_ms</code>.</p><p>Follow these steps to achieve your first successful cram test run:</p><ol><li>Run <code>npm run test:watch</code></li><li>It shows errors because the expected output still contains the <code>duration_ms</code> lines</li><li>Run <code>npm run promote</code> in another terminal to promote the latest output to the expected output</li><li>You should see <code>Success, waiting for filesystem changes...</code></li></ol><p>No test output means it succeeded. Somewhat unintuitively, when cram tests succeed, they remain silent!<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup></p><h2 id="sandbox" tabindex="-1">Sandbox <a class="header-anchor" href="#sandbox" aria-label="Permalink to &quot;Sandbox&quot;">​</a></h2><p>All cram tests execute in a <a href="https://dune.readthedocs.io/en/stable/tests.html#sandboxing" target="_blank" rel="noreferrer">sandbox</a>. What goes into the sandbox directory is determined by the value of the <code>cram/deps</code> field in your <code>dune</code> file. Let’s write an explorative cram test that allows us to peek inside the sandbox. First, install the <a href="https://www.npmjs.com/package/tree-node-cli" target="_blank" rel="noreferrer">tree-node-cli package</a>:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--save-dev</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">tree-node-cli</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--save-dev</span><span style="color:#24292E;"> </span><span style="color:#032F62;">tree-node-cli</span></span></code></pre></div><p>Then add a new cram test to <code>src/order-confirmation/tests.t</code>:</p><div class="language-cram vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cram</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">See all the files inside the sandbox</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;"> npx tree</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">See all the files inside the sandbox</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">$</span><span style="color:#24292E;"> npx tree</span></span></code></pre></div><p>If <code>npm run test:watch</code> is still running, you’ll immediately see some output like this:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;font-weight:bold;">@@ -24,3 +24,8 @@</span><span style="color:#E1E4E8;"> Sandwich tests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> See all the files inside the sandbox</span></span>
<span class="line"><span style="color:#E1E4E8;">   $ npx tree</span></span>
<span class="line"><span style="color:#85E89D;">+  order-confirmation</span></span>
<span class="line"><span style="color:#85E89D;">+  └── output</span></span>
<span class="line"><span style="color:#85E89D;">+      └── src</span></span>
<span class="line"><span style="color:#85E89D;">+          └── order-confirmation</span></span>
<span class="line"><span style="color:#85E89D;">+              └── SandwichTests.mjs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;font-weight:bold;">@@ -24,3 +24,8 @@</span><span style="color:#24292E;"> Sandwich tests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> See all the files inside the sandbox</span></span>
<span class="line"><span style="color:#24292E;">   $ npx tree</span></span>
<span class="line"><span style="color:#22863A;">+  order-confirmation</span></span>
<span class="line"><span style="color:#22863A;">+  └── output</span></span>
<span class="line"><span style="color:#22863A;">+      └── src</span></span>
<span class="line"><span style="color:#22863A;">+          └── order-confirmation</span></span>
<span class="line"><span style="color:#22863A;">+              └── SandwichTests.mjs</span></span></code></pre></div><p>The sandbox directory only contains a single file <code>output/src/order-confirmation/SandwichTests.mjs</code>. Add another explorative cram test:</p><div class="language-cram vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cram</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">Show detail of SandwichTests.mjs</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;"> ls -la ./output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">Show detail of SandwichTests.mjs</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">$</span><span style="color:#24292E;"> ls -la ./output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre></div><p>The output should now look like this:</p><div class="language-diff vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;font-weight:bold;">@@ -24,6 +24,12 @@</span><span style="color:#E1E4E8;"> Sandwich tests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> See all the files inside the sandbox</span></span>
<span class="line"><span style="color:#E1E4E8;">   $ npx tree</span></span>
<span class="line"><span style="color:#85E89D;">+  cram-tests</span></span>
<span class="line"><span style="color:#85E89D;">+  └── output</span></span>
<span class="line"><span style="color:#85E89D;">+      └── src</span></span>
<span class="line"><span style="color:#85E89D;">+          └── cram-tests</span></span>
<span class="line"><span style="color:#85E89D;">+              └── SandwichTests.mjs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;"> Show detail of SandwichTests.mjs</span></span>
<span class="line"><span style="color:#E1E4E8;">   $ ls -la ./output/src/order-confirmation/SandwichTests.mjs</span></span>
<span class="line"><span style="color:#85E89D;">+  lrwxr-xr-x  1 fhsu  staff  86 Mar 16 22:09 ./output/src/order-confirmation/SandwichTests.mjs -&gt; ../../../../../../../../default/src/order-confirmation/output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;font-weight:bold;">@@ -24,6 +24,12 @@</span><span style="color:#24292E;"> Sandwich tests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> See all the files inside the sandbox</span></span>
<span class="line"><span style="color:#24292E;">   $ npx tree</span></span>
<span class="line"><span style="color:#22863A;">+  cram-tests</span></span>
<span class="line"><span style="color:#22863A;">+  └── output</span></span>
<span class="line"><span style="color:#22863A;">+      └── src</span></span>
<span class="line"><span style="color:#22863A;">+          └── cram-tests</span></span>
<span class="line"><span style="color:#22863A;">+              └── SandwichTests.mjs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;"> Show detail of SandwichTests.mjs</span></span>
<span class="line"><span style="color:#24292E;">   $ ls -la ./output/src/order-confirmation/SandwichTests.mjs</span></span>
<span class="line"><span style="color:#22863A;">+  lrwxr-xr-x  1 fhsu  staff  86 Mar 16 22:09 ./output/src/order-confirmation/SandwichTests.mjs -&gt; ../../../../../../../../default/src/order-confirmation/output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre></div><p>From this, you can see that <code>./output/src/order-confirmation/SandwichTests.mjs</code> is actually a symbolic link which links to the real file inside your build directory, specifically this file:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">_build/default/src/order-confirmation/output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">_build/default/src/order-confirmation/output/src/order-confirmation/SandwichTests.mjs</span></span></code></pre></div><p><code>SandwichTests.mjs</code> being a symbolic link explains why you can run the test successfully even when the rest of the <code>.mjs</code> files aren’t present in the sandbox directory.</p><h2 id="better-dependencies" tabindex="-1">Better dependencies <a class="header-anchor" href="#better-dependencies" aria-label="Permalink to &quot;Better dependencies&quot;">​</a></h2><p>There’s a problem with the cram test dependencies. The cram test is re-run if <code>SandwichTests.re</code> changes, but if <code>Item.re</code> (which <code>SandwichTests.re</code> depends on), were to change, it wouldn’t trigger a test re-run. To see this, make the following change to <code>Item.Sandwich.toEmoji</code>:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">toEmoji</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> t </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">Printf</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">sprintf(</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🥪(%s)</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (t) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Portabello</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍄</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ham</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🐷</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Unicorn</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🦄</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Turducken</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🦃🦆🐓</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Turducken</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🦃🦆🐓💩</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  )</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">toEmoji</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> t </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">Printf</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">sprintf(</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🥪(%s)</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (t) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Portabello</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍄</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ham</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🐷</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Unicorn</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🦄</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span></span>
<span class="line diff remove"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Turducken</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🦃🦆🐓</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Turducken</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🦃🦆🐓💩</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">    }</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">  )</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>In the terminal in which <code>npm run test:watch</code> is running, you would expect to see a failing test, but no errors appear. You have to add <code>(alias melange)</code> to <code>cram/deps</code>:</p><div class="language-dune vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dune</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">(cram</span></span>
<span class="line"><span style="color:#E1E4E8;"> (deps</span></span>
<span class="line"><span style="color:#E1E4E8;">  (alias melange)</span></span>
<span class="line"><span style="color:#E1E4E8;">  .</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">output</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">src</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">order-confirmation</span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;">SandwichTests.mjs))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">(cram</span></span>
<span class="line"><span style="color:#24292E;"> (deps</span></span>
<span class="line"><span style="color:#24292E;">  (alias melange)</span></span>
<span class="line"><span style="color:#24292E;">  .</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">output</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">src</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">order-confirmation</span><span style="color:#D73A49;">/</span><span style="color:#24292E;">SandwichTests.mjs))</span></span></code></pre></div><p>Now the test finally fails. The presence of <code>(alias melange)</code> means that all build targets attached to the <code>@melange</code> alias are now dependencies for the cram tests in this directory.</p><h2 id="expand-aliases-in-sandbox-stanza" tabindex="-1"><code>expand_aliases_in_sandbox</code> stanza <a class="header-anchor" href="#expand-aliases-in-sandbox-stanza" aria-label="Permalink to &quot;\`expand_aliases_in_sandbox\` stanza&quot;">​</a></h2><p>If you kept the <code>$ npx tree</code> cram test around, you’ll observe that even though all build targets attached to <code>@melange</code> are dependencies, they aren’t copied into the sandbox directory. You can change that behavior by adding the <a href="https://dune.readthedocs.io/en/stable/reference/dune-project/expand_aliases_in_sandbox.html" target="_blank" rel="noreferrer">expand_aliases_in_sandbox stanza</a> to your <code>dune-project</code> file:</p><div class="language-dune vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dune</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">; Copy all build targets for an alias into the sandbox</span></span>
<span class="line"><span style="color:#E1E4E8;">(expand_aliases_in_sandbox)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">; Copy all build targets for an alias into the sandbox</span></span>
<span class="line"><span style="color:#24292E;">(expand_aliases_in_sandbox)</span></span></code></pre></div><p>The <code>npx tree</code> cram test makes it clear that a lot of files have been copied over to the sandbox directory. Since <code>SandwichTests.mjs</code> is a <code>@melange</code> build target too, it is redundant and can be removed from <code>cram/deps</code>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">(cram</span></span>
<span class="line"><span style="color:#e1e4e8;"> (deps</span></span>
<span class="line"><span style="color:#e1e4e8;">  (alias melange)))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">(cram</span></span>
<span class="line"><span style="color:#24292e;"> (deps</span></span>
<span class="line"><span style="color:#24292e;">  (alias melange)))</span></span></code></pre></div><p>Fix the bug in <code>Item.re</code>. The <code>SandwichTests</code> cram test should pass once more.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Using <code>expand_aliases_in_sandbox</code> is very convenient, but it may noticeably impact cram test performance. If you feel your cram tests are too slow, you should remove it and go back to putting <code>.mjs</code> files in your <code>cram/deps</code> field.</p></div><hr><p>Fantastico! You’ve set up Dune cram tests to streamline the testing process. In the next chapter, we’ll add logic for promotional discounts.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><ul><li>A cram test runs a command inside a sandbox and compares the output of that command with some expected output</li><li>Dune has extensive support for cram tests, including the ability to promote the latest output to become the expected output</li><li>A <code>cram</code> stanza is used to specify dependencies for your cram tests</li><li>Cram test files have the <code>.t</code> extension</li><li>Aliases are virtual build targets that other build targets can be attached to</li><li>Cram tests that produce nondeterministic output must have their output be sanitized</li><li>Cram tests execute in a sandbox</li><li>For Melange projects, <code>(alias melange)</code> is generally the best dependency for your cram tests</li><li>The <code>expand_aliases_in_sandbox</code> stanza allows you to avoid having to put generated <code>.mjs</code> files in your cram test dependencies, at the cost of having slower cram tests</li></ul><h2 id="exercises" tabindex="-1">Exercises <a class="header-anchor" href="#exercises" aria-label="Permalink to &quot;Exercises&quot;">​</a></h2><p><b>1.</b> Add new source file <code>src/order-confirmation/BurgerTests.re</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">open</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Fest</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;A fully-loaded burger&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">open</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Fest</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;A fully-loaded burger&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Fix the broken logic inside the test and add a new cram test for <code>BurgerTests</code> in <code>src/order-confirmation/tests.t</code>.</p><details class="details custom-block"><summary>Solution</summary><p>Fixed test:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;A fully-loaded burger&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔{🥬,🍅,🧅×2,🧀×3,🥓×4}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;A fully-loaded burger&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔{🥬,🍅,🧅×2,🧀×3,🥓×4}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>New cram test:</p><div class="language-cram vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">cram</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">Burger tests</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">$</span><span style="color:#E1E4E8;"> node ./output/src/order-confirmation/BurgerTests.mjs | sed </span><span style="color:#9ECBFF;">&#39;/duration_ms/d&#39;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">TAP version 13</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># Subtest: A fully-loaded burger</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">ok 1 - A fully-loaded burger</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ---</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">  ...</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;">1..1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># tests 1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># suites 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># pass 1</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># fail 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># cancelled 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># skipped 0</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#9ECBFF;"># todo 0</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">Burger tests</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">$</span><span style="color:#24292E;"> node ./output/src/order-confirmation/BurgerTests.mjs | sed </span><span style="color:#032F62;">&#39;/duration_ms/d&#39;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">TAP version 13</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># Subtest: A fully-loaded burger</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">ok 1 - A fully-loaded burger</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ---</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">  ...</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">1..1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># tests 1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># suites 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># pass 1</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># fail 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># cancelled 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># skipped 0</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;"># todo 0</span></span></code></pre></div></details><p><b>2.</b> Add three more tests to <code>BurgerTests</code> module:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;Burger with 0 of onions, cheese, or bacon doesn&#39;t show those emoji&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji(</span><span style="color:#6A737D;">/* burger record */</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test(</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#DBEDFF;">&quot;Burger with 1 of onions, cheese, or bacon should show just the emoji without ×&quot;</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji(</span><span style="color:#6A737D;">/* burger record */</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;Burger with 2 or more of onions, cheese, or bacon should show ×&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji(</span><span style="color:#6A737D;">/* burger record */</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;Burger with 0 of onions, cheese, or bacon doesn&#39;t show those emoji&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji(</span><span style="color:#6A737D;">/* burger record */</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test(</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;Burger with 1 of onions, cheese, or bacon should show just the emoji without ×&quot;</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji(</span><span style="color:#6A737D;">/* burger record */</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;Burger with 2 or more of onions, cheese, or bacon should show ×&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji(</span><span style="color:#6A737D;">/* burger record */</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Get the tests to pass and promote the new test output.</p><details class="details custom-block"><summary>Solution</summary><p>Fixed tests:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;Burger with 0 of onions, cheese, or bacon doesn&#39;t show those emoji&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔{🥬,🍅}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test(</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#DBEDFF;">&quot;Burger with 1 of onions, cheese, or bacon should show just the emoji without ×&quot;</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔{🥬,🍅,🧅,🧀,🥓}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;Burger with 2 or more of onions, cheese, or bacon should show ×&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔{🥬,🍅,🧅×2,🧀×2,🥓×2}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span></span>
<span class="line"><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;Burger with 0 of onions, cheese, or bacon doesn&#39;t show those emoji&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔{🥬,🍅}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test(</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;Burger with 1 of onions, cheese, or bacon should show just the emoji without ×&quot;</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔{🥬,🍅,🧅,🧀,🥓}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;Burger with 2 or more of onions, cheese, or bacon should show ×&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔{🥬,🍅,🧅×2,🧀×2,🥓×2}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span></span>
<span class="line"><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span></code></pre></div></details><p><b>3.</b> Recently, some Cafe Emoji customers have gotten into the habit of ordering burgers with an absurd number of toppings. You can barely even hold these monstrous burgers in your hands, and on the small chance that you manage to grab one, it will explode as soon as you bite into it. Madame Jellobutter has therefore decided that whenever someone orders a burger with more than 12 toppings, it will be served in a big bowl. Add the following test to <code>BurgerTests</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">test(</span><span style="color:#DBEDFF;">&quot;Burger with more than 12 toppings should also show bowl emoji&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">5</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔🥣{🥬,🍅,🧅×4,🧀×2,🥓×5}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  expect</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> equal(</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Burger</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji({</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       })</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔{🥬,🍅,🧅×4,🧀×2,🥓×4}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">     )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">test(</span><span style="color:#032F62;">&quot;Burger with more than 12 toppings should also show bowl emoji&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">5</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔🥣{🥬,🍅,🧅×4,🧀×2,🥓×5}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  expect</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> equal(</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Burger</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji({</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       })</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔{🥬,🍅,🧅×4,🧀×2,🥓×4}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">     )</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">})</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Now update <code>Item.Burger.toEmoji</code> to make that test pass.</p><details class="details custom-block"><summary>Hint</summary><p>Note that <code>lettuce</code> and <code>tomatoes</code> each count as 1 topping.</p></details><details class="details custom-block"><summary>Solution</summary><p>New version of <code>Item.Burger.toEmoji</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">toEmoji</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> t </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">multiple</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (emoji</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> count) </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (count) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> emoji</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">count</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Printf</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">sprintf(</span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">%s×%d</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> emoji</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> count)</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (t) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> {</span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bacon</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> {</span><span style="color:#B392F0;">lettuce</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onions</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">cheese</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">tomatoes</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bacon</span><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">toppingsCount</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">      (lettuce </span><span style="color:#FFAB70;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">+</span><span style="color:#E1E4E8;"> (tomatoes </span><span style="color:#FFAB70;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">+</span><span style="color:#E1E4E8;"> onions </span><span style="color:#FDAEB7;">+</span><span style="color:#E1E4E8;"> cheese </span><span style="color:#FDAEB7;">+</span><span style="color:#E1E4E8;"> bacon</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Printf</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">sprintf(</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍔%s{%s}</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      toppingsCount </span><span style="color:#FDAEB7;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">12</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🥣</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">[|</span></span>
<span class="line"><span style="color:#E1E4E8;">        lettuce </span><span style="color:#FDAEB7;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🥬</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        tomatoes </span><span style="color:#FDAEB7;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🍅</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        multiple(</span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🧅</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> onions)</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        multiple(</span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🧀</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> cheese)</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        multiple(</span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">🥓</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">js</span><span style="color:#FDAEB7;">}</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> bacon)</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">|]</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Array</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">filter(~f</span><span style="color:#FDAEB7;">=</span><span style="color:#E1E4E8;">str </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> str </span><span style="color:#FDAEB7;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Array</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">join(~sep</span><span style="color:#FDAEB7;">=</span><span style="color:#DBEDFF;">&quot;,&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">toEmoji</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> t </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">multiple</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (emoji</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> count) </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (count) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> emoji</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">count</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Printf</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">sprintf(</span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">%s×%d</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> emoji</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> count)</span></span>
<span class="line"><span style="color:#24292E;">    }</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (t) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bacon</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">} </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> {</span><span style="color:#6F42C1;">lettuce</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onions</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">cheese</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">tomatoes</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bacon</span><span style="color:#24292E;">} </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">toppingsCount</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">      (lettuce </span><span style="color:#E36209;">?</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">+</span><span style="color:#24292E;"> (tomatoes </span><span style="color:#E36209;">?</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">+</span><span style="color:#24292E;"> onions </span><span style="color:#B31D28;">+</span><span style="color:#24292E;"> cheese </span><span style="color:#B31D28;">+</span><span style="color:#24292E;"> bacon</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Printf</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">sprintf(</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍔%s{%s}</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">      toppingsCount </span><span style="color:#B31D28;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">12</span><span style="color:#24292E;"> </span><span style="color:#E36209;">?</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🥣</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">[|</span></span>
<span class="line"><span style="color:#24292E;">        lettuce </span><span style="color:#B31D28;">?</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🥬</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">        tomatoes </span><span style="color:#B31D28;">?</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🍅</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">        multiple(</span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🧅</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> onions)</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">        multiple(</span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🧀</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> cheese)</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">        multiple(</span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">🥓</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">js</span><span style="color:#B31D28;">}</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> bacon)</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">|]</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Array</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">filter(~f</span><span style="color:#B31D28;">=</span><span style="color:#24292E;">str </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> str </span><span style="color:#B31D28;">!=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Array</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">join(~sep</span><span style="color:#B31D28;">=</span><span style="color:#032F62;">&quot;,&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    )</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span><span style="color:#B31D28;">;</span></span></code></pre></div></details><hr><p>View <a href="https://github.com/melange-re/melange-for-react-devs/blob/main/src/cram-tests/" target="_blank" rel="noreferrer">source code</a> and <a href="https://react-book.melange.re/demo/src/cram-tests/" target="_blank" rel="noreferrer">demo</a> for this chapter.</p><hr><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>You might notice that the output from Node test runner looks different when run inside a cram test. That’s because it uses different <a href="https://nodejs.org/api/test.html#test-reporters" target="_blank" rel="noreferrer">test reporters</a> depending on whether you run it directly or through another process. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>A successful cram test won’t print any output from the test, but you may see some logging that indicates that build targets were produced, e.g.</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">refmt</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/Item.re.ml</span></span>
<span class="line"><span style="color:#B392F0;">ppx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/Item.re.pp.ml</span></span>
<span class="line"><span style="color:#B392F0;">ocamldep</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/.output.mobjs/melange__Item.impl.d</span></span>
<span class="line"><span style="color:#B392F0;">melc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/.output.mobjs/melange/melange__Item.{cmi,cmj,cmt}</span></span>
<span class="line"><span style="color:#B392F0;">melc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/output/src/order-confirmation/Item.mjs</span></span>
<span class="line"><span style="color:#B392F0;">melc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/.output.mobjs/melange/melange__SandwichTests.{cmi,cmj,cmt}</span></span>
<span class="line"><span style="color:#B392F0;">melc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/.output.mobjs/melange/melange__Order.{cmi,cmj,cmt}</span></span>
<span class="line"><span style="color:#B392F0;">melc</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">src/order-confirmation/.output.mobjs/melange/melange__Index.{cmi,cmj,cmt}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">refmt</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/Item.re.ml</span></span>
<span class="line"><span style="color:#6F42C1;">ppx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/Item.re.pp.ml</span></span>
<span class="line"><span style="color:#6F42C1;">ocamldep</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/.output.mobjs/melange__Item.impl.d</span></span>
<span class="line"><span style="color:#6F42C1;">melc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/.output.mobjs/melange/melange__Item.{cmi,cmj,cmt}</span></span>
<span class="line"><span style="color:#6F42C1;">melc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/output/src/order-confirmation/Item.mjs</span></span>
<span class="line"><span style="color:#6F42C1;">melc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/.output.mobjs/melange/melange__SandwichTests.{cmi,cmj,cmt}</span></span>
<span class="line"><span style="color:#6F42C1;">melc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/.output.mobjs/melange/melange__Order.{cmi,cmj,cmt}</span></span>
<span class="line"><span style="color:#6F42C1;">melc</span><span style="color:#24292E;"> </span><span style="color:#032F62;">src/order-confirmation/.output.mobjs/melange/melange__Index.{cmi,cmj,cmt}</span></span></code></pre></div> <a href="#fnref2" class="footnote-backref">↩︎</a></li></ol></section>`,94),e=[p];function t(c,r,y,E,i,d){return n(),a("div",null,e)}const B=s(o,[["render",t]]);export{u as __pageData,B as default};
