import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.0e8ae64e.js";const D=JSON.parse('{"title":"Promo Component","description":"","frontmatter":{},"headers":[],"relativePath":"promo-component/index.md","filePath":"promo-component/index.md","lastUpdated":1719022376000}'),o={name:"promo-component/index.md"},p=l(`<h1 id="promo-component" tabindex="-1">Promo Component <a class="header-anchor" href="#promo-component" aria-label="Permalink to &quot;Promo Component&quot;">​</a></h1><p>Your work so far has left a deep impression on Madame Jellobutter, so much so that she even sends you on an all-expenses paid trip to an <a href="https://fun-ocaml.com/" target="_blank" rel="noreferrer">OCaml Hackathon</a>. As soon as you arrive, you make several new friends, and you even meet MonadicFanatic1984 in person!<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup> You’re extremely psyched to start applying the things you’re learning during the hackathon.</p><h2 id="rr-utility-module" tabindex="-1"><code>RR</code> utility module <a class="header-anchor" href="#rr-utility-module" aria-label="Permalink to &quot;\`RR\` utility module&quot;">​</a></h2><p>While having lunch during the hackathon, fellow attendee FunctorPunk<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup> suggests that you create a dedicated module for your ReasonReact-related helper functions. Add a new file <code>RR.re</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/** Get string value from the given event&#39;s target */</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getValueFromEvent</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (evt)</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> string </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">target(evt)</span><span style="color:#FDAEB7;">##</span><span style="color:#E1E4E8;">value</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** Alias for [React.string] */</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">s</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">string</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** Render a list of [React.element]s */</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">list</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> list </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> list </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Stdlib</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Array</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">of_list </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">array</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** Render a float as currency */</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">currency</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> value </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> value </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Float</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toFixed(~digits</span><span style="color:#FDAEB7;">=</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">string</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/** Get string value from the given event&#39;s target */</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getValueFromEvent</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (evt)</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> string </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">target(evt)</span><span style="color:#B31D28;">##</span><span style="color:#24292E;">value</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** Alias for [React.string] */</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">s</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">string</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** Render a list of [React.element]s */</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">list</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> list </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> list </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Stdlib</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Array</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">of_list </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">array</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">/** Render a float as currency */</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">currency</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> value </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> value </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Float</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toFixed(~digits</span><span style="color:#B31D28;">=</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">string</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>These are all functions we used before, but now they’re in one handy place and also have documentation comments.</p><h2 id="documentation-comment-markup-language" tabindex="-1">Documentation comment markup language <a class="header-anchor" href="#documentation-comment-markup-language" aria-label="Permalink to &quot;Documentation comment markup language&quot;">​</a></h2><p>In a couple of the documentation comments, you see square brackets (<code>[]</code>):</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">/** Alias for [React.string] */</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">/** Alias for [React.string] */</span></span></code></pre></div><p>Whatever is inside the brackets gets rendered in a monospace source code font. This is one example of the <a href="https://ocaml.org/manual/5.2/ocamldoc.html#ss:ocamldoc-formatting" target="_blank" rel="noreferrer">markup language</a> used inside documentation comments.</p><h2 id="promo-component-1" tabindex="-1"><code>Promo</code> component <a class="header-anchor" href="#promo-component-1" aria-label="Permalink to &quot;\`Promo\` component&quot;">​</a></h2><p>Add new file <code>Promo.re</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useState(</span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">input</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">code</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> setCode(_ </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getValueFromEvent(evt))}</span></span>
<span class="line"><span style="color:#E1E4E8;">    /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: Discount value or error&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useState(</span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">form</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onSubmit</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">input</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">value</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">code</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">onChange</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> setCode(_ </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getValueFromEvent(evt))}</span></span>
<span class="line"><span style="color:#24292E;">    /&gt;</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: Discount value or error&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">form</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>For now, it just shows an input that allows the user to enter a promo code.</p><h2 id="react-usereducer" tabindex="-1"><code>React.useReducer</code> <a class="header-anchor" href="#react-usereducer" aria-label="Permalink to &quot;\`React.useReducer\`&quot;">​</a></h2><p>Another neat trick you learn from FunctorPunk is that you can substitute <a href="https://reasonml.github.io/reason-react/docs/en/usestate-hook" target="_blank" rel="noreferrer">React.useState</a> with <a href="https://reasonml.github.io/reason-react/docs/en/usereducer-hook" target="_blank" rel="noreferrer">React.useReducer</a><sup class="footnote-ref"><a href="#fn3" id="fnref3">[3]</a></sup> when defining <a href="https://react.dev/learn/state-a-components-memory#adding-a-state-variable" target="_blank" rel="noreferrer">state variables</a>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">dispatch</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useReducer((_state</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> newState) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> newState</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">input</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">code</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> dispatch(</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getValueFromEvent(evt))}</span></span>
<span class="line"><span style="color:#E1E4E8;">    /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: Discount value or error&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">dispatch</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useReducer((_state</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> newState) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> newState</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">form</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onSubmit</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">input</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">value</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">code</span></span>
<span class="line highlighted"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">onChange</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> dispatch(</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getValueFromEvent(evt))}</span></span>
<span class="line"><span style="color:#24292E;">    /&gt;</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: Discount value or error&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">form</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>The advantage of this is that you can update state by passing a value instead of a callback. To make it even nicer, we can also rename <code>dispatch</code> to <code>setCode</code> and use function chaining inside the <code>onChange</code> callback:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useReducer((_state</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> newState) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> newState</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">input</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">code</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getValueFromEvent </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> setCode}</span></span>
<span class="line"><span style="color:#E1E4E8;">    /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: Discount value or error&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useReducer((_state</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> newState) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> newState</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">form</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onSubmit</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">input</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">value</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">code</span></span>
<span class="line highlighted"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">onChange</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getValueFromEvent </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> setCode}</span></span>
<span class="line"><span style="color:#24292E;">    /&gt;</span></span>
<span class="line"><span style="color:#24292E;">    {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: Discount value or error&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">form</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><h2 id="rr-usestatevalue-helper-function" tabindex="-1"><code>RR.useStateValue</code> helper function <a class="header-anchor" href="#rr-usestatevalue-helper-function" aria-label="Permalink to &quot;\`RR.useStateValue\` helper function&quot;">​</a></h2><p>This state variable pattern can be made more convenient by adding a new helper function called <code>RR.useStateValue</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">/** Like [React.useState] but doesn&#39;t use callback functions */</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useStateValue</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> initial </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useReducer((_state</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> newState) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> newState</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> initial)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">/** Like [React.useState] but doesn&#39;t use callback functions */</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useStateValue</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> initial </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useReducer((_state</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> newState) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> newState</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> initial)</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>The state setup code in <code>Promo</code> then becomes very simple:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff remove"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useReducer((_state</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> newState) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> newState</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line diff add"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useStateValue(</span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span><span style="color:#E1E4E8;"> </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span></span>
<span class="line diff remove"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useReducer((_state</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> newState) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> newState</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span><span style="color:#24292E;"> </span></span>
<span class="line diff add"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useStateValue(</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span><span style="color:#24292E;"> </span></span></code></pre></div><h2 id="add-promo-to-index" tabindex="-1">Add <code>Promo</code> to <code>Index</code> <a class="header-anchor" href="#add-promo-to-index" aria-label="Permalink to &quot;Add \`Promo\` to \`Index\`&quot;">​</a></h2><p>The <code>Promo</code> component isn’t finished yet, but let’s add it to <code>Index</code> so that we can see how it looks as we’re building it:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt; {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Promo&quot;</span><span style="color:#E1E4E8;">)} &lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#B392F0;">Promo</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">items</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">date</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{</span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">fromString(</span><span style="color:#DBEDFF;">&quot;2024-05-10T00:00&quot;</span><span style="color:#E1E4E8;">)} /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt; {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Order confirmation&quot;</span><span style="color:#E1E4E8;">)} &lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#B392F0;">Order</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">items</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt; {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Promo&quot;</span><span style="color:#24292E;">)} &lt;/</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    &lt;</span><span style="color:#6F42C1;">Promo</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">items</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">date</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{</span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">fromString(</span><span style="color:#032F62;">&quot;2024-05-10T00:00&quot;</span><span style="color:#24292E;">)} /&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt; {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Order confirmation&quot;</span><span style="color:#24292E;">)} &lt;/</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#6F42C1;">Order</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">items</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>We know that, sooner or later, we must pass <code>items</code> and <code>date</code> to <code>Promo</code>, so we just do it now. However, this breaks the build because <code>Promo</code> doesn’t yet define those props.</p><h2 id="temporarily-ignore-props" tabindex="-1">Temporarily ignore props <a class="header-anchor" href="#temporarily-ignore-props" aria-label="Permalink to &quot;Temporarily ignore props&quot;">​</a></h2><p>We can quickfix it by adding the <code>~items</code> and <code>~date</code> props to <code>Promo.make</code> and then immediately <code>ignore</code>ing them in the body of the function:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> ~date</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">ignore</span><span style="color:#E1E4E8;">(items)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">ignore</span><span style="color:#E1E4E8;">(date)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> ~date</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">ignore</span><span style="color:#24292E;">(items)</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">ignore</span><span style="color:#24292E;">(date)</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>A more concise way to temporarily ignore props is to use the <code>as</code> keyword in the function argument list:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items as _</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> ~date as _</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items as _</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> ~date as _</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span></code></pre></div><p>Here we rename <code>~items</code> to <code>_</code>, effectively ignoring it, and also do the same for <code>~date</code>. Note that this renaming only extends to the scope of the function itself.</p><h2 id="styled-ppx-package" tabindex="-1"><code>styled-ppx</code> package <a class="header-anchor" href="#styled-ppx-package" aria-label="Permalink to &quot;\`styled-ppx\` package&quot;">​</a></h2><p>During dinner, you meet a cool human named Dave who introduces you to <a href="https://ocaml.org/p/styled-ppx" target="_blank" rel="noreferrer">styled-ppx</a>, the package he authored to allow writing type-safe CSS inside OCaml. It’s inspired by <a href="https://emotion.sh/docs/introduction" target="_blank" rel="noreferrer">Emotion</a>, and also uses Emotion under the hood.</p><p>To install <code>styled-ppx</code>, open your terminal and run:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">@emotion/css</span></span>
<span class="line"><span style="color:#B392F0;">opam</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">install</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">styled-ppx</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">@emotion/css</span></span>
<span class="line"><span style="color:#6F42C1;">opam</span><span style="color:#24292E;"> </span><span style="color:#032F62;">install</span><span style="color:#24292E;"> </span><span style="color:#032F62;">styled-ppx</span></span></code></pre></div><p>After these commands finish, see what version of <code>styled-ppx</code> was installed by running <code>opam list</code>:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">...</span></span>
<span class="line"><span style="color:#e1e4e8;">stdune                3.15.2      Dune&#39;s unstable standard library</span></span>
<span class="line"><span style="color:#e1e4e8;">stringext             1.6.0       Extra string functions for OCaml</span></span>
<span class="line highlighted"><span style="color:#e1e4e8;">styled-ppx            0.56.0      Type-safe styled components for ReScript and Melange</span></span>
<span class="line"><span style="color:#e1e4e8;">time_now              v0.16.0     Reports the current time</span></span>
<span class="line"><span style="color:#e1e4e8;">topkg                 1.0.7       The transitory OCaml software packager</span></span>
<span class="line"><span style="color:#e1e4e8;">...</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#24292e;">...</span></span>
<span class="line"><span style="color:#24292e;">stdune                3.15.2      Dune&#39;s unstable standard library</span></span>
<span class="line"><span style="color:#24292e;">stringext             1.6.0       Extra string functions for OCaml</span></span>
<span class="line highlighted"><span style="color:#24292e;">styled-ppx            0.56.0      Type-safe styled components for ReScript and Melange</span></span>
<span class="line"><span style="color:#24292e;">time_now              v0.16.0     Reports the current time</span></span>
<span class="line"><span style="color:#24292e;">topkg                 1.0.7       The transitory OCaml software packager</span></span>
<span class="line"><span style="color:#24292e;">...</span></span></code></pre></div><p>Add <code>&quot;styled-ppx&quot; {&gt;= &quot;0.56.0&quot;}</code> to the <code>depends</code> section of your <code>.opam</code> file. (Adjust the version based on what you see from <code>ocaml list</code>.)</p><p>To make sure that the version of <code>@emotion/css</code> you got from npm is compatible with the version of <code>styled-ppx</code> you got from opam, run</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">npm</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">run</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">check-npm-deps</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">npm</span><span style="color:#24292E;"> </span><span style="color:#032F62;">run</span><span style="color:#24292E;"> </span><span style="color:#032F62;">check-npm-deps</span></span></code></pre></div><p>You should see some output like this:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">Ok: opam package &quot;reason-react.0.14.0&quot; requires npm package: &quot;react-dom&quot; with constraint &quot;^18.0.0&quot;, version installed: &quot;18.2.0&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">Ok: opam package &quot;reason-react.0.14.0&quot; requires npm package: &quot;react&quot; with constraint &quot;^18.0.0&quot;, version installed: &quot;18.2.0&quot;</span></span>
<span class="line"><span style="color:#e1e4e8;">Ok: opam package &quot;styled-ppx.0.56.0&quot; requires npm package: &quot;@emotion/css&quot; with constraint &quot;&gt;=11.0.0&quot;, version installed: &quot;11.11.2&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">Ok: opam package &quot;reason-react.0.14.0&quot; requires npm package: &quot;react-dom&quot; with constraint &quot;^18.0.0&quot;, version installed: &quot;18.2.0&quot;</span></span>
<span class="line"><span style="color:#24292e;">Ok: opam package &quot;reason-react.0.14.0&quot; requires npm package: &quot;react&quot; with constraint &quot;^18.0.0&quot;, version installed: &quot;18.2.0&quot;</span></span>
<span class="line"><span style="color:#24292e;">Ok: opam package &quot;styled-ppx.0.56.0&quot; requires npm package: &quot;@emotion/css&quot; with constraint &quot;&gt;=11.0.0&quot;, version installed: &quot;11.11.2&quot;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Underneath the covers, <code>npm run check-npm-deps</code> is just running <code>opam exec opam-check-npm-deps</code>.</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>The output from <code>npm run check-npm-deps</code> might not show anything for <code>styled-ppx</code> yet, that should be fixed soon.</p></div><h2 id="add-styles-to-promo" tabindex="-1">Add styles to <code>Promo</code> <a class="header-anchor" href="#add-styles-to-promo" aria-label="Permalink to &quot;Add styles to \`Promo\`&quot;">​</a></h2><p>Try adding a style to <code>Promo</code>’s <code>form</code> element:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">form</span></span>
<span class="line diff add"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">[%</span><span style="color:#B392F0;">cx</span><span style="color:#E1E4E8;"> {|</span><span style="color:#B392F0;">display</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">flex</span><span style="color:#E1E4E8;">; </span><span style="color:#B392F0;">flex</span><span style="color:#E1E4E8;">-</span><span style="color:#B392F0;">direction</span><span style="color:#E1E4E8;">: </span><span style="color:#B392F0;">column</span><span style="color:#E1E4E8;">;|}] </span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">preventDefault}&gt;</span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">form</span></span>
<span class="line diff add"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">[%</span><span style="color:#6F42C1;">cx</span><span style="color:#24292E;"> {|</span><span style="color:#6F42C1;">display</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">flex</span><span style="color:#24292E;">; </span><span style="color:#6F42C1;">flex</span><span style="color:#24292E;">-</span><span style="color:#6F42C1;">direction</span><span style="color:#24292E;">: </span><span style="color:#6F42C1;">column</span><span style="color:#24292E;">;|}] </span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">onSubmit</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">preventDefault}&gt;</span></span></code></pre></div><p>You’ll get a compilation error:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">File &quot;src/order-confirmation/Promo.re&quot;, line 6, characters 16-18:</span></span>
<span class="line"><span style="color:#e1e4e8;">6 |     className=[%cx {|display: flex; flex-direction: column;|}]</span></span>
<span class="line"><span style="color:#e1e4e8;">                    ^^</span></span>
<span class="line"><span style="color:#e1e4e8;">Error: Uninterpreted extension &#39;cx&#39;.</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">File &quot;src/order-confirmation/Promo.re&quot;, line 6, characters 16-18:</span></span>
<span class="line"><span style="color:#24292e;">6 |     className=[%cx {|display: flex; flex-direction: column;|}]</span></span>
<span class="line"><span style="color:#24292e;">                    ^^</span></span>
<span class="line"><span style="color:#24292e;">Error: Uninterpreted extension &#39;cx&#39;.</span></span></code></pre></div><p><code>styled-ppx</code> is installed, but it can’t be used until the <code>libraries</code> and <code>preprocess/pps</code> stanzas of your <code>dune</code> file have been updated:</p><div class="language-dune vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">dune</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">(libraries reason-react melange-fest styled-ppx.emotion)</span></span>
<span class="line"><span style="color:#E1E4E8;"> (preprocess</span></span>
<span class="line"><span style="color:#E1E4E8;">  (pps melange.ppx reason-react-ppx styled-ppx))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">(libraries reason-react melange-fest styled-ppx.emotion)</span></span>
<span class="line"><span style="color:#24292E;"> (preprocess</span></span>
<span class="line"><span style="color:#24292E;">  (pps melange.ppx reason-react-ppx styled-ppx))</span></span></code></pre></div><p>For reference:</p><ul><li>Add <code>styled-ppx.emotion</code> to <code>libraries</code> to enable the <code>Css</code> and <code>CssJs</code> modules</li><li>Add <code>styled-ppx</code> to <code>preprocess/pps</code> to enable the <code>%cx</code> extension node</li></ul><p>If you run <code>npm run serve</code>, you’ll see that the styles are now applied.</p><h2 id="promo-style-submodule" tabindex="-1"><code>Promo.Style</code> submodule <a class="header-anchor" href="#promo-style-submodule" aria-label="Permalink to &quot;\`Promo.Style\` submodule&quot;">​</a></h2><p>Although you can use the <code>%cx</code> extension node inline within your JSX, it’s usually a good idea to put all of them in a <code>Style</code> submodule within your component module:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#FDAEB7;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Style</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">form</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{|</span></span>
<span class="line"><span style="color:#DBEDFF;">    display: flex;</span></span>
<span class="line"><span style="color:#DBEDFF;">    flex-direction: column;</span></span>
<span class="line"><span style="color:#DBEDFF;">  </span><span style="color:#FDAEB7;">|}</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">input</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">{|</span></span>
<span class="line"><span style="color:#DBEDFF;">    font-family: monospace;</span></span>
<span class="line"><span style="color:#DBEDFF;">    text-transform: uppercase;</span></span>
<span class="line"><span style="color:#DBEDFF;">    </span><span style="color:#FDAEB7;">|}</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#B31D28;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Style</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">form</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{|</span></span>
<span class="line"><span style="color:#032F62;">    display: flex;</span></span>
<span class="line"><span style="color:#032F62;">    flex-direction: column;</span></span>
<span class="line"><span style="color:#032F62;">  </span><span style="color:#B31D28;">|}</span><span style="color:#24292E;">]</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">input</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">{|</span></span>
<span class="line"><span style="color:#032F62;">    font-family: monospace;</span></span>
<span class="line"><span style="color:#032F62;">    text-transform: uppercase;</span></span>
<span class="line"><span style="color:#032F62;">    </span><span style="color:#B31D28;">|}</span></span>
<span class="line"><span style="color:#24292E;">  ]</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Then update your JSX:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">form</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">form</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">input</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">input</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">code</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getValueFromEvent </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> setCode}</span></span>
<span class="line"><span style="color:#E1E4E8;">  /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: Discount value or error&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">form</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">form</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">onSubmit</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">preventDefault}&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">input</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">input</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">value</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">code</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">onChange</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getValueFromEvent </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> setCode}</span></span>
<span class="line"><span style="color:#24292E;">  /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: Discount value or error&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">form</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Using a <code>Style</code> submodule encourages reuse of class names and tends to make your JSX more readable.</p><h2 id="styled-ppx-is-type-safe" tabindex="-1"><code>styled-ppx</code> is type-safe <a class="header-anchor" href="#styled-ppx-is-type-safe" aria-label="Permalink to &quot;\`styled-ppx\` is type-safe&quot;">​</a></h2><p>The strings we pass to the <code>%cx</code> extension must be valid CSS and each property must have a valid value. To see this in action, change the value of the <code>flex-direction</code> property:</p><div class="language-css vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line diff remove"><span style="color:#85E89D;">flex-direction</span><span style="color:#E1E4E8;">: column; </span></span>
<span class="line diff add"><span style="color:#85E89D;">flex-direction</span><span style="color:#E1E4E8;">: col; </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line diff remove"><span style="color:#22863A;">flex-direction</span><span style="color:#24292E;">: column; </span></span>
<span class="line diff add"><span style="color:#22863A;">flex-direction</span><span style="color:#24292E;">: col; </span></span></code></pre></div><p>You’ll get this compilation error:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">File &quot;src/order-confirmation/Promo.re&quot;, lines 3-4, characters 37-43:</span></span>
<span class="line"><span style="color:#e1e4e8;">2 | ...................</span></span>
<span class="line"><span style="color:#e1e4e8;">3 | .................;</span></span>
<span class="line"><span style="color:#e1e4e8;">4 |     flex-direction: col.</span></span>
<span class="line"><span style="color:#e1e4e8;">Error: Property &#39;flex-direction&#39; has an invalid value: &#39;col&#39;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">File &quot;src/order-confirmation/Promo.re&quot;, lines 3-4, characters 37-43:</span></span>
<span class="line"><span style="color:#24292e;">2 | ...................</span></span>
<span class="line"><span style="color:#24292e;">3 | .................;</span></span>
<span class="line"><span style="color:#24292e;">4 |     flex-direction: col.</span></span>
<span class="line"><span style="color:#24292e;">Error: Property &#39;flex-direction&#39; has an invalid value: &#39;col&#39;</span></span></code></pre></div><p>Introduce some other errors to your CSS code and see what happens.</p><h2 id="install-vscode-styled-ppx-extension" tabindex="-1">Install <code>vscode-styled-ppx</code> extension <a class="header-anchor" href="#install-vscode-styled-ppx-extension" aria-label="Permalink to &quot;Install \`vscode-styled-ppx\` extension&quot;">​</a></h2><p>Now that we’re writing our CSS inside our OCaml code, the CSS is no longer highlighted. VS Code users can resolve this by simply installing Dave’s <a href="https://marketplace.visualstudio.com/items?itemName=davesnx.vscode-styled-ppx" target="_blank" rel="noreferrer">vscode-styled-ppx extension</a>.</p><h2 id="add-submittedcode-state-variable" tabindex="-1">Add <code>submittedCode</code> state variable <a class="header-anchor" href="#add-submittedcode-state-variable" aria-label="Permalink to &quot;Add \`submittedCode\` state variable&quot;">​</a></h2><p>Add a new state variable named <code>submittedCode</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useStateValue(</span><span style="color:#DBEDFF;">&quot;&quot;</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line highlighted"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">submittedCode</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setSubmittedCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useStateValue(</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">form</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">form</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">onSubmit</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Event</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Form</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">preventDefault</span><span style="color:#FDAEB7;">;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    setSubmittedCode(</span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(code))</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }}&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">input</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">input</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">value</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">code</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">onChange</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{evt </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">      evt </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getValueFromEvent </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> setCode</span><span style="color:#FDAEB7;">;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">      setSubmittedCode(</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    }}</span></span>
<span class="line"><span style="color:#E1E4E8;">  /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: Discount value or error&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">form</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useStateValue(</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line highlighted"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">submittedCode</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setSubmittedCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useStateValue(</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">form</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">form</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">onSubmit</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Event</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Form</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">preventDefault</span><span style="color:#B31D28;">;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    setSubmittedCode(</span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(code))</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  }}&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">input</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">input</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">value</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">code</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">onChange</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{evt </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">      evt </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getValueFromEvent </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> setCode</span><span style="color:#B31D28;">;</span></span>
<span class="line highlighted"><span style="color:#24292E;">      setSubmittedCode(</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">    }}</span></span>
<span class="line"><span style="color:#24292E;">  /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: Discount value or error&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">form</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>A breakdown:</p><ul><li>The initial value of <code>submittedCode</code> is <code>None</code>, meaning the user hasn’t yet submitted a promo code</li><li>Pressing the <code>Enter</code> key while editing the input submits the promo code, setting <code>submittedCode</code> to <code>Some(code)</code></li><li>Editing the input cancels the submitted promo code by setting <code>submittedCode</code> back to <code>None</code></li></ul><h2 id="add-discountfunction-derived-variable" tabindex="-1">Add <code>discountFunction</code> derived variable <a class="header-anchor" href="#add-discountfunction-derived-variable" aria-label="Permalink to &quot;Add \`discountFunction\` derived variable&quot;">​</a></h2><p>Add a <code>discountFunction</code> variable that derives its value from <code>submittedCode</code> and <code>date</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">submittedCode</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">setSubmittedCode</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">useStateValue(</span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">discountFunction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">  submittedCode</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Option</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">map(code </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDiscountFunction(code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date))</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">submittedCode</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">setSubmittedCode</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">useStateValue(</span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">discountFunction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">  submittedCode</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Option</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">map(code </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDiscountFunction(code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date))</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>We have to use <code>Option.map</code> since <code>submittedCode</code>’s type is <code>option(string)</code>. Also, we must stop ignoring the <code>date</code> prop in order to use its value:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line diff remove"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items as _</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> ~date as _</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> { </span></span>
<span class="line diff add"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items as _</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> ~date</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> { </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line diff remove"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items as _</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> ~date as _</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> { </span></span>
<span class="line diff add"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items as _</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> ~date</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> { </span></span></code></pre></div><h2 id="render-discountfunction" tabindex="-1">Render <code>discountFunction</code> <a class="header-anchor" href="#render-discountfunction" aria-label="Permalink to &quot;Render \`discountFunction\`&quot;">​</a></h2><p>Render <code>discountFunction</code> under the <code>input</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">input</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">/* ... */</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discountFunction) {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">null</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">error</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">codeError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">errorType</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">InvalidCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;Invalid&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ExpiredCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;Expired&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">$errorType promo code</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> }}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">input</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">/* ... */</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discountFunction) {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">null</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">error</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">codeError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">errorType</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (error) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">InvalidCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Invalid&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ExpiredCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Expired&quot;</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">$errorType promo code</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> }}</span></span></code></pre></div><p>We only render <code>discountFunction</code> when it’s in the error state.</p><p>We also need to add the <code>codeError</code> class name to the <code>Style</code> submodule, which will cause promo code error messages to be rendered in red:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">codeError</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{|</span><span style="color:#DBEDFF;">color: red</span><span style="color:#FDAEB7;">|}</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">codeError</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{|</span><span style="color:#032F62;">color: red</span><span style="color:#B31D28;">|}</span><span style="color:#24292E;">]</span><span style="color:#B31D28;">;</span></span></code></pre></div><h2 id="add-discount-derived-variable" tabindex="-1">Add <code>discount</code> derived variable <a class="header-anchor" href="#add-discount-derived-variable" aria-label="Permalink to &quot;Add \`discount\` derived variable&quot;">​</a></h2><p>Add a <code>discount</code> variable that derives its value from <code>discountFunction</code> and <code>items</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">discountFunction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">  submittedCode</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Option</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">map(code </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDiscountFunction(code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date))</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">discount</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discountFunction) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">discountFunction</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(discountFunction(items))</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">discountFunction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">  submittedCode</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Option</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">map(code </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDiscountFunction(code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date))</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">discount</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discountFunction) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">discountFunction</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(discountFunction(items))</span></span>
<span class="line"><span style="color:#24292E;">  }</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>To use the value of the <code>items</code> prop, we must stop ignoring it:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark has-diff vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line diff remove"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items as _</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> ~date</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> { </span></span>
<span class="line diff add"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> ~date</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> { </span></span></code></pre><pre class="shiki github-light has-diff vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line diff remove"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items as _</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> ~date</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> { </span></span>
<span class="line diff add"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> ~date</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> { </span></span></code></pre></div><h2 id="render-discount" tabindex="-1">Render <code>discount</code> <a class="header-anchor" href="#render-discount" aria-label="Permalink to &quot;Render \`discount\`&quot;">​</a></h2><p>Render <code>discount</code> under where we render <code>discountFunction</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discountFunction) {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">null</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">/* ... */</span></span>
<span class="line"><span style="color:#E1E4E8;"> }}</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discount) {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">null</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> value </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Float</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">neg </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">currency</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_code</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">discountError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: discount error message&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> }}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discountFunction) {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">null</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">/* ... */</span></span>
<span class="line"><span style="color:#24292E;"> }}</span></span>
<span class="line"><span style="color:#24292E;">{</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discount) {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">null</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> value </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Float</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">neg </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">currency</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_code</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">discountError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: discount error message&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> }}</span></span></code></pre></div><ul><li>When <code>discount</code> is of the form <code>Some(Ok(value))</code>, then the discount must exist and we show its value (with a minus sign in front to indicate that the amount will be subtracted from the total value).</li><li>When <code>discount</code> is of the form <code>Some(Error(code))</code>, then an error occurred and we should render an error message based on the value of <code>code</code> (this is left as an exercise at the end of the chapter).</li></ul><p>We also need to add <code>discountError</code> to the <code>Style</code> submodule, which will cause the discount error to be rendered in purple:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">discountError</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{|</span><span style="color:#DBEDFF;">color: purple</span><span style="color:#FDAEB7;">|}</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">discountError</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{|</span><span style="color:#032F62;">color: purple</span><span style="color:#B31D28;">|}</span><span style="color:#24292E;">]</span><span style="color:#B31D28;">;</span></span></code></pre></div><h2 id="use-one-switch-expression" tabindex="-1">Use one switch expression <a class="header-anchor" href="#use-one-switch-expression" aria-label="Permalink to &quot;Use one switch expression&quot;">​</a></h2><p>The current rendering logic is unsatisfactory. On first glance, it looks as if <code>discountFunction</code> is rendered first, and then <code>discount</code> is rendered below it. But in reality, only one of the derived variables is ever rendered at a time. That suggests that we could use a single switch expression for the render logic. It’s helpful to list the four mutually-exclusive states we need to render:</p><table><thead><tr><th>State</th><th>What to render</th></tr></thead><tbody><tr><td>No promo code submitted</td><td>Nothing</td></tr><tr><td>Promo code invalid or expired</td><td>Error message, e.g. “Invalid promo code”</td></tr><tr><td>Error applying discount</td><td>Error message, e.g. “Buy at least one more burger to enjoy this promotion”</td></tr><tr><td>Discount</td><td>The value of the discount with a minus sign in front</td></tr></tbody></table><p>One way to refactor to a single switch expression is to change the input of the switch expression to be the tuple <code>(discountFunction, discount)</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discountFunction</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> discount) {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;">))) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> value </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Float</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">neg </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">currency</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">error</span><span style="color:#E1E4E8;">))</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">codeError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">errorType</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">InvalidCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;Invalid&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ExpiredCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;Expired&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">$errorType promo code</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#6A737D;">_</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_code</span><span style="color:#E1E4E8;">))) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">discountError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: discount error message&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">None</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">None</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;">)) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">null</span></span>
<span class="line"><span style="color:#E1E4E8;"> }}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discountFunction</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> discount) {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;">))) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> value </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Float</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">neg </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">currency</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">error</span><span style="color:#24292E;">))</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">_</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">codeError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">errorType</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (error) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">InvalidCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Invalid&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ExpiredCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Expired&quot;</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">$errorType promo code</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> (</span><span style="color:#6A737D;">_</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_code</span><span style="color:#24292E;">))) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">discountError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: discount error message&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">None</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">None</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_</span><span style="color:#24292E;">)) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">null</span></span>
<span class="line"><span style="color:#24292E;"> }}</span></span></code></pre></div><p>This works, but it’s a lot of pattern matching to render just four states.</p><h2 id="use-a-single-discount-derived-variable" tabindex="-1">Use a single <code>discount</code> derived variable <a class="header-anchor" href="#use-a-single-discount-derived-variable" aria-label="Permalink to &quot;Use a single \`discount\` derived variable&quot;">​</a></h2><p>We cannot have better rendering logic without first refactoring the derived variables. Replace <code>discountFunction</code> and <code>discount</code> with just a single derived variable <code>discount</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">discount</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (submittedCode) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">None</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NoSubmittedCode</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Some</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (</span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDiscountFunction(code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">error</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">CodeError</span><span style="color:#E1E4E8;">(error)</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">discountFunction</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discountFunction(items)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">error</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">DiscountError</span><span style="color:#E1E4E8;">(error)</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">value</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">Discount</span><span style="color:#E1E4E8;">(value)</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">discount</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (submittedCode) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">None</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NoSubmittedCode</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Some</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">code</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (</span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDiscountFunction(code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date)) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">error</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">CodeError</span><span style="color:#24292E;">(error)</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">discountFunction</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discountFunction(items)) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">error</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">DiscountError</span><span style="color:#24292E;">(error)</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">value</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">Discount</span><span style="color:#24292E;">(value)</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  }</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Here we used three nested switch expressions to explicitly map the values from all the inputs to the four mutually-exclusive states we want to render. The flow of data goes like this:</p><ol><li>If <code>submittedCode</code> is <code>None</code>, return <code> \`NoSubmittedCode</code></li><li>If <code>submittedCode</code> is <code>Some(code)</code>, then invoke <code>Discount.getDiscountFunction(code, date)</code><ol><li>If the result of <code>Discount.getDiscountFunction(code, date)</code> is <code>Error(error)</code>, then return <code> \`CodeError(error)</code></li><li>If the result of <code>Discount.getDiscountFunction(code, date)</code> is <code>Ok(discountFunction)</code>, then invoke <code>discountFunction(items)</code><ol><li>If the result of <code>discountFunction(items)</code> is <code>Error(error)</code>, then return <code> \`DiscountError(error)</code></li><li>If the result of <code>discountFunction(items)</code> is <code>Ok(value)</code>, then return <code> \`Discount(value)</code></li></ol></li></ol></li></ol><p>Because we use polymorphic variant tags, we don’t need to define a new type. If you hover over the <code>discount</code> variable in your editor you’ll see that its inferred type is:</p><div class="language-reason vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">reason</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">[</span><span style="color:#FDAEB7;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">CodeError</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">error)</span></span>
<span class="line"><span style="color:#E1E4E8;"> | </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">Discount</span><span style="color:#E1E4E8;">(float)</span></span>
<span class="line"><span style="color:#E1E4E8;"> | </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">DiscountError</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">[</span><span style="color:#FDAEB7;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">MissingSandwichTypes</span></span>
<span class="line"><span style="color:#E1E4E8;">                   | </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NeedMegaBurger</span></span>
<span class="line"><span style="color:#E1E4E8;">                   | </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NeedOneBurger</span></span>
<span class="line"><span style="color:#E1E4E8;">                   | </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NeedTwoBurgers</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">]</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;"> | </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NoSubmittedCode</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">[</span><span style="color:#B31D28;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">CodeError</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">error)</span></span>
<span class="line"><span style="color:#24292E;"> | </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">Discount</span><span style="color:#24292E;">(float)</span></span>
<span class="line"><span style="color:#24292E;"> | </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">DiscountError</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">[</span><span style="color:#B31D28;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">MissingSandwichTypes</span></span>
<span class="line"><span style="color:#24292E;">                   | </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NeedMegaBurger</span></span>
<span class="line"><span style="color:#24292E;">                   | </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NeedOneBurger</span></span>
<span class="line"><span style="color:#24292E;">                   | </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NeedTwoBurgers</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">]</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;"> | </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NoSubmittedCode</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">]</span></span></code></pre></div><h2 id="render-discount-polymorphic-variant" tabindex="-1">Render <code>discount</code> polymorphic variant <a class="header-anchor" href="#render-discount-polymorphic-variant" aria-label="Permalink to &quot;Render \`discount\` polymorphic variant&quot;">​</a></h2><p>Now change the switch expression in your render logic to take the <code>discount</code> polymorphic variant as its only input:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discount) {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NoSubmittedCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">React</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">null</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">Discount</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">discount</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> discount </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Float</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">neg </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">currency</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">CodeError</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">error</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">codeError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">errorType</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (error) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">InvalidCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;Invalid&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">ExpiredCode</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;Expired&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">$errorType promo code</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">DiscountError</span><span style="color:#E1E4E8;">(</span><span style="color:#6A737D;">_code</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">discountError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Todo: discount error message&quot;</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;"> }}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discount) {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NoSubmittedCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">React</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">null</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">Discount</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">discount</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> discount </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Float</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">neg </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">currency</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">CodeError</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">error</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">codeError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">errorType</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (error) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">InvalidCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Invalid&quot;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">ExpiredCode</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;Expired&quot;</span></span>
<span class="line"><span style="color:#24292E;">        }</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">$errorType promo code</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">}</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">DiscountError</span><span style="color:#24292E;">(</span><span style="color:#6A737D;">_code</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">discountError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Todo: discount error message&quot;</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;"> }}</span></span></code></pre></div><p>The pattern matching is now more concise and more readable, and it is still type-safe. Try commenting out the <code> \`NoSubmittedCode</code> branch and you’ll get a compilation error:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">File &quot;src/order-confirmation/Promo.re&quot;, lines 52-68, characters 4-7:</span></span>
<span class="line"><span style="color:#e1e4e8;">52 | ....{switch (discount) {</span></span>
<span class="line"><span style="color:#e1e4e8;">53 |      //  | \`NoSubmittedCode =&gt; React.null</span></span>
<span class="line"><span style="color:#e1e4e8;">54 |      | \`Discount(discount) =&gt; discount |&gt; Float.neg |&gt; RR.currency</span></span>
<span class="line"><span style="color:#e1e4e8;">55 |      | \`CodeError(error) =&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">56 |        &lt;div className=Style.codeError&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">...</span></span>
<span class="line"><span style="color:#e1e4e8;">65 |        &lt;div className=Style.discountError&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">66 |          {RR.s(&quot;Todo: discount error message&quot;)}</span></span>
<span class="line"><span style="color:#e1e4e8;">67 |        &lt;/div&gt;</span></span>
<span class="line"><span style="color:#e1e4e8;">68 |      }}</span></span>
<span class="line"><span style="color:#e1e4e8;">Error (warning 8 [partial-match]): this pattern-matching is not exhaustive.</span></span>
<span class="line"><span style="color:#e1e4e8;">Here is an example of a case that is not matched:</span></span>
<span class="line"><span style="color:#e1e4e8;">\`NoSubmittedCode</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">File &quot;src/order-confirmation/Promo.re&quot;, lines 52-68, characters 4-7:</span></span>
<span class="line"><span style="color:#24292e;">52 | ....{switch (discount) {</span></span>
<span class="line"><span style="color:#24292e;">53 |      //  | \`NoSubmittedCode =&gt; React.null</span></span>
<span class="line"><span style="color:#24292e;">54 |      | \`Discount(discount) =&gt; discount |&gt; Float.neg |&gt; RR.currency</span></span>
<span class="line"><span style="color:#24292e;">55 |      | \`CodeError(error) =&gt;</span></span>
<span class="line"><span style="color:#24292e;">56 |        &lt;div className=Style.codeError&gt;</span></span>
<span class="line"><span style="color:#24292e;">...</span></span>
<span class="line"><span style="color:#24292e;">65 |        &lt;div className=Style.discountError&gt;</span></span>
<span class="line"><span style="color:#24292e;">66 |          {RR.s(&quot;Todo: discount error message&quot;)}</span></span>
<span class="line"><span style="color:#24292e;">67 |        &lt;/div&gt;</span></span>
<span class="line"><span style="color:#24292e;">68 |      }}</span></span>
<span class="line"><span style="color:#24292e;">Error (warning 8 [partial-match]): this pattern-matching is not exhaustive.</span></span>
<span class="line"><span style="color:#24292e;">Here is an example of a case that is not matched:</span></span>
<span class="line"><span style="color:#24292e;">\`NoSubmittedCode</span></span></code></pre></div><hr><p>Muy bueno! You’ve created a <code>Promo</code> component that can be used to submit promo codes and see the discounts they produce, along with any errors that might occur. In the next chapter, we’ll integrate this <code>Promo</code> component into your <code>Order</code> component.</p><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to &quot;Overview&quot;">​</a></h2><ul><li>Documentation comments have a markup language</li><li>Use <code>React.useReducer</code> to create state variables that can be set without callback functions <ul><li>You should create a helper function to make this pattern more convenient to use</li></ul></li><li>Temporarily ignore function arguments using the <code>as</code> keyword, e.g. <code>~items as _</code> will cause the <code>~items</code> argument to be ignored</li><li>The <code>styled-ppx</code> package allows you to write type-safe CSS inside your OCaml code <ul><li>You must add some extra values to the <code>libraries</code> and <code>preprocess/pps</code> fields of your <code>dune</code> file to use <code>styled-ppx</code></li><li>Write your CSS inside the <code>%cx</code> extension node</li><li>It’s a good idea to group the class names you create using <code>%cx</code> inside a submodule of your component module (you can name it <code>Style</code> or something similar)</li><li>Install the <code>vscode-styled-ppx</code> VS Code extension to get syntax highlighting for CSS written inside <code>%cx</code></li></ul></li><li>Run <code>opam exec opam-check-npm-deps</code> to check that your NPM dependencies are compatible with your Melange packages</li><li>A good strategy for rendering mutually-exclusive states is to create a single switch expression that maps your inputs to each state, where each state is represented by a different variant tag.</li></ul><h2 id="exercises" tabindex="-1">Exercises <a class="header-anchor" href="#exercises" aria-label="Permalink to &quot;Exercises&quot;">​</a></h2><p><b>1.</b> Render the different error messages for the <code> \`DiscountError</code> branch of <code>Promo</code>’s switch expression. Here’s what message should be shown for each tag:</p><table><thead><tr><th>Variant tag</th><th>Message</th></tr></thead><tbody><tr><td><code> \`NeedOneBurger</code></td><td>Buy at least 1 more burger to enjoy this promotion</td></tr><tr><td><code> \`NeedTwoBurgers</code></td><td>Buy at least 1 more burgers to enjoy this promotion</td></tr><tr><td><code> \`NeedMegaBurger</code></td><td>Buy a burger with every topping to enjoy this promotion</td></tr><tr><td><code> \`MissingSandwichTypes</code></td><td>Buy every sandwich to enjoy this promotion</td></tr></tbody></table><details class="details custom-block"><summary>Solution</summary><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (discount) {</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">/* ... */</span></span>
<span class="line"><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">DiscountError</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">code</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">buyWhat</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (code) {</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NeedOneBurger</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;at least 1 more burger&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NeedTwoBurgers</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;at least 2 burgers&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">NeedMegaBurger</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;a burger with every topping&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">     </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">MissingSandwichTypes</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;every sandwich&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">     }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">discountError</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">     {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#FDAEB7;">{</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">|</span><span style="color:#DBEDFF;">Buy $buyWhat to enjoy this promotion</span><span style="color:#FDAEB7;">|</span><span style="color:#79B8FF;">j</span><span style="color:#FDAEB7;">}</span><span style="color:#E1E4E8;">)}</span></span>
<span class="line"><span style="color:#E1E4E8;">   &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;"> }}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (discount) {</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#6A737D;">/* ... */</span></span>
<span class="line"><span style="color:#24292E;"> </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">DiscountError</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">code</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">buyWhat</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (code) {</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NeedOneBurger</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;at least 1 more burger&quot;</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NeedTwoBurgers</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;at least 2 burgers&quot;</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">NeedMegaBurger</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;a burger with every topping&quot;</span></span>
<span class="line"><span style="color:#24292E;">     </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">MissingSandwichTypes</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;every sandwich&quot;</span></span>
<span class="line"><span style="color:#24292E;">     }</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">   &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">discountError</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">     {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#B31D28;">{</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">|</span><span style="color:#032F62;">Buy $buyWhat to enjoy this promotion</span><span style="color:#B31D28;">|</span><span style="color:#005CC5;">j</span><span style="color:#B31D28;">}</span><span style="color:#24292E;">)}</span></span>
<span class="line"><span style="color:#24292E;">   &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;"> }}</span></span></code></pre></div></details><p><b>2.</b> Refactor the <code>Order</code> component to use <code>styled-ppx</code> and your new <code>RR</code> helper function module.</p><details class="details custom-block"><summary>Hint</summary><p><code>styled-ppx</code> supports <a href="https://styled-ppx.vercel.app/reference/selectors" target="_blank" rel="noreferrer">nested selectors</a>.</p></details><details class="details custom-block"><summary>Solution</summary><p>After refactoring, <code>Order.re</code> might look something like this:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">t</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">list</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FDAEB7;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">OrderItem</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Style</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">item</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{|</span><span style="color:#DBEDFF;">border-top: 1px solid lightgray;</span><span style="color:#FDAEB7;">|}</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">emoji</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{|</span><span style="color:#DBEDFF;">font-size: 2em;</span><span style="color:#FDAEB7;">|}</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">price</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">{|</span><span style="color:#DBEDFF;">text-align: right;</span><span style="color:#FDAEB7;">|}</span><span style="color:#E1E4E8;">]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  [</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~item</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">tr</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">item</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">emoji</span><span style="color:#E1E4E8;">&gt; {item </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toEmoji </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s} &lt;/</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">price</span><span style="color:#E1E4E8;">&gt; {item </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toPrice </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">currency} &lt;/</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">tr</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FDAEB7;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Style</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">order</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">{|</span></span>
<span class="line"><span style="color:#DBEDFF;">    border-collapse: collapse;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#DBEDFF;">    td {</span></span>
<span class="line"><span style="color:#DBEDFF;">      padding: 0.5em;</span></span>
<span class="line"><span style="color:#DBEDFF;">    }</span></span>
<span class="line"><span style="color:#DBEDFF;">    </span><span style="color:#FDAEB7;">|}</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">total</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> [</span><span style="color:#F97583;">%</span><span style="color:#79B8FF;">cx</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">{|</span></span>
<span class="line"><span style="color:#DBEDFF;">    border-top: 1px solid gray;</span></span>
<span class="line"><span style="color:#DBEDFF;">    font-weight: bold;</span></span>
<span class="line"><span style="color:#DBEDFF;">    text-align: right;</span></span>
<span class="line"><span style="color:#DBEDFF;">    </span><span style="color:#FDAEB7;">|}</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#F97583;">@</span><span style="color:#B392F0;">react</span><span style="color:#F97583;">.</span><span style="color:#79B8FF;">component</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">make</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (~items</span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">t</span><span style="color:#E1E4E8;">) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">total</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">    items</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">ListLabels</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">fold_left(~init</span><span style="color:#FDAEB7;">=</span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">.,</span><span style="color:#E1E4E8;"> ~f</span><span style="color:#FDAEB7;">=</span><span style="color:#E1E4E8;">(acc</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> order) </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">         acc </span><span style="color:#FDAEB7;">+.</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Item</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toPrice(order)</span></span>
<span class="line"><span style="color:#E1E4E8;">       )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">table</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">order</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">tbody</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      {items</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">List</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">mapi((index</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> item) </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;</span><span style="color:#B392F0;">OrderItem</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">key</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{</span><span style="color:#DBEDFF;">&quot;item-&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">++</span><span style="color:#E1E4E8;"> string_of_int(index)} </span><span style="color:#B392F0;">item</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          )</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">list}</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">tr</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">className</span><span style="color:#F97583;">=</span><span style="color:#B392F0;">Style</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">total</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;">&gt; {</span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">s(</span><span style="color:#DBEDFF;">&quot;Total&quot;</span><span style="color:#E1E4E8;">)} &lt;/</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;">&gt; {total </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">RR</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">currency} &lt;/</span><span style="color:#85E89D;">td</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#85E89D;">tr</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">tbody</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">table</span><span style="color:#E1E4E8;">&gt;</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">type</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">t</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#032F62;">list</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B31D28;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">OrderItem</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Style</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">item</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{|</span><span style="color:#032F62;">border-top: 1px solid lightgray;</span><span style="color:#B31D28;">|}</span><span style="color:#24292E;">]</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">emoji</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{|</span><span style="color:#032F62;">font-size: 2em;</span><span style="color:#B31D28;">|}</span><span style="color:#24292E;">]</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">price</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">{|</span><span style="color:#032F62;">text-align: right;</span><span style="color:#B31D28;">|}</span><span style="color:#24292E;">]</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  [</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~item</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">tr</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">item</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">td</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">emoji</span><span style="color:#24292E;">&gt; {item </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toEmoji </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s} &lt;/</span><span style="color:#22863A;">td</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">td</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">price</span><span style="color:#24292E;">&gt; {item </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toPrice </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">currency} &lt;/</span><span style="color:#22863A;">td</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">tr</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B31D28;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Style</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">order</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">{|</span></span>
<span class="line"><span style="color:#032F62;">    border-collapse: collapse;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">    td {</span></span>
<span class="line"><span style="color:#032F62;">      padding: 0.5em;</span></span>
<span class="line"><span style="color:#032F62;">    }</span></span>
<span class="line"><span style="color:#032F62;">    </span><span style="color:#B31D28;">|}</span></span>
<span class="line"><span style="color:#24292E;">  ]</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">total</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> [</span><span style="color:#D73A49;">%</span><span style="color:#005CC5;">cx</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">{|</span></span>
<span class="line"><span style="color:#032F62;">    border-top: 1px solid gray;</span></span>
<span class="line"><span style="color:#032F62;">    font-weight: bold;</span></span>
<span class="line"><span style="color:#032F62;">    text-align: right;</span></span>
<span class="line"><span style="color:#032F62;">    </span><span style="color:#B31D28;">|}</span></span>
<span class="line"><span style="color:#24292E;">  ]</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#D73A49;">@</span><span style="color:#6F42C1;">react</span><span style="color:#D73A49;">.</span><span style="color:#005CC5;">component</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">make</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (~items</span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">t</span><span style="color:#24292E;">) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">total</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">    items</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">ListLabels</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">fold_left(~init</span><span style="color:#B31D28;">=</span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">.,</span><span style="color:#24292E;"> ~f</span><span style="color:#B31D28;">=</span><span style="color:#24292E;">(acc</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> order) </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">         acc </span><span style="color:#B31D28;">+.</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Item</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toPrice(order)</span></span>
<span class="line"><span style="color:#24292E;">       )</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">table</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">order</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">tbody</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      {items</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">List</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">mapi((index</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> item) </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">            &lt;</span><span style="color:#6F42C1;">OrderItem</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">key</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{</span><span style="color:#032F62;">&quot;item-&quot;</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">++</span><span style="color:#24292E;"> string_of_int(index)} </span><span style="color:#6F42C1;">item</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">          )</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">list}</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">tr</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">className</span><span style="color:#D73A49;">=</span><span style="color:#6F42C1;">Style</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">total</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">td</span><span style="color:#24292E;">&gt; {</span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">s(</span><span style="color:#032F62;">&quot;Total&quot;</span><span style="color:#24292E;">)} &lt;/</span><span style="color:#22863A;">td</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">td</span><span style="color:#24292E;">&gt; {total </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">RR</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">currency} &lt;/</span><span style="color:#22863A;">td</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/</span><span style="color:#22863A;">tr</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">tbody</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">table</span><span style="color:#24292E;">&gt;</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>You should do some cleanup:</p><ul><li>Delete <code>Format</code> module, since it has been replaced by <code>RR</code>.</li><li>Delete <code>order-item.module.css</code> and <code>order.module.css</code> files, since they are no longer used.</li><li>Delete the <code>melange.emit/runtime_deps</code> stanza from your <code>dune</code> file, since there are no more <code>.css</code> files to copy into the build directory.</li></ul></details><p><b>3.</b> Right now, <code>Item.toPrice</code> is a nondeterministic function—it returns a different price for a turducken sandwich depending on the day of the week<sup class="footnote-ref"><a href="#fn4" id="fnref4">[4]</a></sup>. This makes writing some discount tests more complicated than necessary, and could cause more problems down the road. Refactor <code>Item.toPrice</code> by adding a labeled argument <code>~date</code>, then:</p><ul><li>Fix the resulting compilation errors by adding <code>~date</code> arguments to functions higher on the call chain</li><li>Simplify the tests that have this comment: <code>// Don&#39;t use hardcoded value since Item.toPrice is non-deterministic</code></li><li>You might break the tests in <code>DiscountTests.GetDiscount</code>, but don’t worry about that for now. We’ll fix those tests in the following exercise.</li></ul><details class="details custom-block"><summary>Hint</summary><p>Let the compilation errors guide your refactoring.</p></details><details class="details custom-block"><summary>Hint</summary><p>Feel free to make liberal use of partial application.</p></details><details class="details custom-block"><summary>Solution</summary><p>Most of the changes are fairly mechanical, consisting of adding a <code>~date</code> argument up the function call chain until you get to <code>Index.App.make</code>.</p><p>There is at least one point of interest—you can opt to not give <code>Discount.getFreeBurgers</code> a <code>~date</code> argument, since it only computes prices of burgers, which don’t fluctuate with time. But then you must use partial application in <code>Discount.getDiscountFunction</code>:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDiscountFunction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">month</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> date </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getMonth</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">dayOfMonth</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> date </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDate</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (code </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">String</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toUpperCase) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;FREE&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> month </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(getFreeBurgers)</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> month </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">&amp;&amp;</span><span style="color:#E1E4E8;"> dayOfMonth </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">28</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(getHalfOff(~date))</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> month </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">&amp;&amp;</span><span style="color:#E1E4E8;"> dayOfMonth </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(getSandwichHalfOff(~date))</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;FREE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">ExpiredCode</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">InvalidCode</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDiscountFunction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> date </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getMonth</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">dayOfMonth</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> date </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDate</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (code </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">String</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toUpperCase) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;FREE&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> month </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(getFreeBurgers)</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> month </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">&amp;&amp;</span><span style="color:#24292E;"> dayOfMonth </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">28</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(getHalfOff(~date))</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> month </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">&amp;&amp;</span><span style="color:#24292E;"> dayOfMonth </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(getSandwichHalfOff(~date))</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;FREE&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">ExpiredCode</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">_</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">InvalidCode</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  }</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>The indirect consequence of this is that tests like this fail:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">test(</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#DBEDFF;">&quot;HALF promo code returns getHalfOff on May 28 but not other days of May&quot;</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">()</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">dayOfMonth</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">31</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">date</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">makeWithYMD(</span></span>
<span class="line"><span style="color:#E1E4E8;">        ~year</span><span style="color:#FDAEB7;">=</span><span style="color:#79B8FF;">2024</span><span style="color:#FDAEB7;">.,</span></span>
<span class="line"><span style="color:#E1E4E8;">        ~month</span><span style="color:#FDAEB7;">=</span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        ~date</span><span style="color:#FDAEB7;">=</span><span style="color:#E1E4E8;">float_of_int(dayOfMonth)</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    expect</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> deepEqual(</span></span>
<span class="line"><span style="color:#E1E4E8;">         </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDiscountFunction(</span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date)</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">         dayOfMonth </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">28</span></span>
<span class="line"><span style="color:#E1E4E8;">           </span><span style="color:#FFAB70;">?</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">(</span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getHalfOff(~date)) </span><span style="color:#FDAEB7;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">ExpiredCode</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">       )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">test(</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#032F62;">&quot;HALF promo code returns getHalfOff on May 28 but not other days of May&quot;</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">()</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">dayOfMonth</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">to</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">31</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">date</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">makeWithYMD(</span></span>
<span class="line"><span style="color:#24292E;">        ~year</span><span style="color:#B31D28;">=</span><span style="color:#005CC5;">2024</span><span style="color:#B31D28;">.,</span></span>
<span class="line"><span style="color:#24292E;">        ~month</span><span style="color:#B31D28;">=</span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">        ~date</span><span style="color:#B31D28;">=</span><span style="color:#24292E;">float_of_int(dayOfMonth)</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">      )</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    expect</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> deepEqual(</span></span>
<span class="line"><span style="color:#24292E;">         </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDiscountFunction(</span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date)</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">         dayOfMonth </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">28</span></span>
<span class="line"><span style="color:#24292E;">           </span><span style="color:#E36209;">?</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">(</span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getHalfOff(~date)) </span><span style="color:#B31D28;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">ExpiredCode</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">       )</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">})</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Comparing two partially-applied functions for strict equality will always fail, because they are two newly-created objects. See <a href="https://melange.re/v4.0.0/playground/?language=Reason&amp;code=bGV0IGZvbyA9IChhLCB%2BYikgPT4gYSArIGI7CgovLyBVc2Ugc3RyaWN0IGVxdWFsaXR5ICg9PT0pIHdoZW4gY29tcGFyaW5nIGZ1bmN0aW9ucwpKcy5sb2coZm9vID09PSBmb28pOyAvLyB0cnVlCkpzLmxvZyhmb28ofmI9MSkgPT09IGZvbyh%2BYj0xKSk7IC8vIGZhbHNl&amp;live=off" target="_blank" rel="noreferrer">this playground snippet</a> for a concise demonstration of this.</p><p>The next exercise will explore how we can make the tests pass without adding an extraneous <code>~date</code> argument to <code>Discount.getFreeBurgers</code>.</p></details><p><b>4.</b> Fix the tests in <code>DiscountTests.GetDiscount</code> that were broken by your refactoring in the previous exercise.</p><details class="details custom-block"><summary>Hint</summary><p>Make a helper function that is similar to <code>Discount.getDiscountFunction</code> but can return something like this: <code>Ok((\`FreeBurgers, getFreeBurgers))</code></p></details><details class="details custom-block"><summary>Hint</summary><p>Use <a href="https://melange.re/v3.0.0/api/re/melange/Stdlib/Result/#val-map" target="_blank" rel="noreferrer">Result.map</a>, <a href="https://melange.re/v3.0.0/api/re/melange/Stdlib/#val-fst" target="_blank" rel="noreferrer">fst</a>, and <a href="https://melange.re/v3.0.0/api/re/melange/Stdlib/#val-snd" target="_blank" rel="noreferrer">snd</a>.</p></details><details class="details custom-block"><summary>Solution</summary><p>Inside <code>Discount</code>, define a helper function called <code>getDiscountPair</code>, and redefine <code>getDiscountFunction</code> using it:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDiscountPair</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date) </span><span style="color:#FDAEB7;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">month</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> date </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getMonth</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">dayOfMonth</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> date </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDate</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">switch</span><span style="color:#E1E4E8;"> (code </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">String</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">toUpperCase) {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;FREE&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> month </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">FreeBurgers</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> getFreeBurgers))</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> month </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">&amp;&amp;</span><span style="color:#E1E4E8;"> dayOfMonth </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">28</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">HalfOff</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> getHalfOff(~date)))</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">when</span><span style="color:#E1E4E8;"> month </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">10</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;">&amp;&amp;</span><span style="color:#E1E4E8;"> dayOfMonth </span><span style="color:#FDAEB7;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">Ok</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">\`</span><span style="color:#79B8FF;">SandwichHalfOff</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> getSandwichHalfOff(~date)))</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;FREE&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#DBEDFF;">&quot;HALF&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">ExpiredCode</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#FDAEB7;">|</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">_</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">Error</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">InvalidCode</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDiscountFunction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date) </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  getDiscountPair(code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date) </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Result</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">map(snd)</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDiscountPair</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date) </span><span style="color:#B31D28;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">month</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> date </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getMonth</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">dayOfMonth</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> date </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDate</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">switch</span><span style="color:#24292E;"> (code </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">String</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">toUpperCase) {</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;FREE&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> month </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">((</span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">FreeBurgers</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> getFreeBurgers))</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> month </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">&amp;&amp;</span><span style="color:#24292E;"> dayOfMonth </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">28</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">((</span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">HalfOff</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> getHalfOff(~date)))</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">when</span><span style="color:#24292E;"> month </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">10</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#B31D28;">&amp;&amp;</span><span style="color:#24292E;"> dayOfMonth </span><span style="color:#B31D28;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#005CC5;">Ok</span><span style="color:#24292E;">((</span><span style="color:#E36209;">\`</span><span style="color:#005CC5;">SandwichHalfOff</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> getSandwichHalfOff(~date)))</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;FREE&quot;</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;HALF&quot;</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">ExpiredCode</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#B31D28;">|</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">_</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">Error</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">InvalidCode</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">  }</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDiscountFunction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date) </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line"><span style="color:#24292E;">  getDiscountPair(code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date) </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Result</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">map(snd)</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>The type signature of <code>getDiscountFunction</code> remains unchanged, returning a function encased in <code>Ok</code> when it succeeds. In contrast, <code>getDiscountPair</code> returns a 2-tuple encased in <code>Ok</code>:</p><ul><li>The first element of the tuple is a variant tag indicating which function was returned, e.g. <code> \`FreeBurger</code>, <code> \`HalfOff</code>, etc.</li><li>The second element of the tuple is the discount function</li></ul><p>The variant tag serves to give test code something to compare against:</p><div class="language-re vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">re</span><pre class="shiki github-dark has-highlighted-lines vp-code-dark"><code><span class="line"><span style="color:#FDAEB7;">module</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">GetDiscount</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getDiscountFunction</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date) </span><span style="color:#FDAEB7;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">Discount</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">getDiscountPair(code</span><span style="color:#FDAEB7;">,</span><span style="color:#E1E4E8;"> date) </span><span style="color:#FDAEB7;">|&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Result</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">map(fst)</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  test(</span></span>
<span class="line"><span style="color:#E1E4E8;">    &quot;HALF promo code returns getHalfOff on May 28 but not other days of May&quot;,</span></span>
<span class="line"><span style="color:#E1E4E8;">    () =&gt; {</span></span>
<span class="line"><span style="color:#E1E4E8;">    for (dayOfMonth in 1 to 31) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">date</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">Js</span><span style="color:#FDAEB7;">.</span><span style="color:#B392F0;">Date</span><span style="color:#FDAEB7;">.</span><span style="color:#E1E4E8;">makeWithYMD(</span></span>
<span class="line"><span style="color:#E1E4E8;">          ~year</span><span style="color:#FDAEB7;">=</span><span style="color:#79B8FF;">2024</span><span style="color:#FDAEB7;">.,</span></span>
<span class="line"><span style="color:#E1E4E8;">          ~month</span><span style="color:#FDAEB7;">=</span><span style="color:#79B8FF;">4</span><span style="color:#FDAEB7;">.</span><span style="color:#79B8FF;">0</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">          ~date</span><span style="color:#FDAEB7;">=</span><span style="color:#E1E4E8;">float_of_int(dayOfMonth)</span><span style="color:#FDAEB7;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        )</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">      expect</span></span>
<span class="line"><span style="color:#E1E4E8;">      |&gt; deepEqual(</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">           getDiscountFunction(&quot;HALF&quot;, date),</span></span>
<span class="line highlighted"><span style="color:#E1E4E8;">           dayOfMonth == 28 ? Ok(\`HalfOff) : Error(ExpiredCode),</span></span>
<span class="line"><span style="color:#E1E4E8;">         );</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  })</span><span style="color:#FDAEB7;">;</span></span>
<span class="line"><span style="color:#6A737D;">  // ...</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span><span style="color:#FDAEB7;">;</span></span></code></pre><pre class="shiki github-light has-highlighted-lines vp-code-light"><code><span class="line"><span style="color:#B31D28;">module</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">GetDiscount</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line highlighted"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getDiscountFunction</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date) </span><span style="color:#B31D28;">=&gt;</span></span>
<span class="line highlighted"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">Discount</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">getDiscountPair(code</span><span style="color:#B31D28;">,</span><span style="color:#24292E;"> date) </span><span style="color:#B31D28;">|&gt;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Result</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">map(fst)</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">  // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  test(</span></span>
<span class="line"><span style="color:#24292E;">    &quot;HALF promo code returns getHalfOff on May 28 but not other days of May&quot;,</span></span>
<span class="line"><span style="color:#24292E;">    () =&gt; {</span></span>
<span class="line"><span style="color:#24292E;">    for (dayOfMonth in 1 to 31) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">date</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">Js</span><span style="color:#B31D28;">.</span><span style="color:#6F42C1;">Date</span><span style="color:#B31D28;">.</span><span style="color:#24292E;">makeWithYMD(</span></span>
<span class="line"><span style="color:#24292E;">          ~year</span><span style="color:#B31D28;">=</span><span style="color:#005CC5;">2024</span><span style="color:#B31D28;">.,</span></span>
<span class="line"><span style="color:#24292E;">          ~month</span><span style="color:#B31D28;">=</span><span style="color:#005CC5;">4</span><span style="color:#B31D28;">.</span><span style="color:#005CC5;">0</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">          ~date</span><span style="color:#B31D28;">=</span><span style="color:#24292E;">float_of_int(dayOfMonth)</span><span style="color:#B31D28;">,</span></span>
<span class="line"><span style="color:#24292E;">        )</span><span style="color:#B31D28;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">      expect</span></span>
<span class="line"><span style="color:#24292E;">      |&gt; deepEqual(</span></span>
<span class="line highlighted"><span style="color:#24292E;">           getDiscountFunction(&quot;HALF&quot;, date),</span></span>
<span class="line highlighted"><span style="color:#24292E;">           dayOfMonth == 28 ? Ok(\`HalfOff) : Error(ExpiredCode),</span></span>
<span class="line"><span style="color:#24292E;">         );</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  })</span><span style="color:#B31D28;">;</span></span>
<span class="line"><span style="color:#6A737D;">  // ...</span></span>
<span class="line"><span style="color:#24292E;">}</span><span style="color:#B31D28;">;</span></span></code></pre></div><p>Recall that the runtime representation of a variant tag without arguments is just a string. They can be compared using <code>Fest.deepEqual</code> without any surprises.</p><p>Run <code>npm run test</code> to verify that all tests are passing again.</p></details><hr><p>View <a href="https://github.com/melange-re/melange-for-react-devs/blob/main/src/promo-component/" target="_blank" rel="noreferrer">source code</a> and <a href="https://react-book.melange.re/demo/src/promo-component/" target="_blank" rel="noreferrer">demo</a> for this chapter.</p><hr><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>MonadicFanatic1984 in real life is a genetically-modified gorilla who escaped from a mad scientist’s laboratory. He used to be in charge of developing the mad scientist’s website until he escaped because he wanted to migrate the website to Melange but the mad scientist didn’t approve. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li><li id="fn2" class="footnote-item"><p>FunctorPunk is a cybernetically-enhanced wombat who escaped from a mad scientist’s laboratory (no, not the same one). He escaped because FREEDOM. <a href="#fnref2" class="footnote-backref">↩︎</a></p></li><li id="fn3" class="footnote-item"><p><code>React.useReducer</code> is the ReasonReact binding for React’s <a href="https://react.dev/reference/react/useReducer" target="_blank" rel="noreferrer">useReducer hook</a>. <a href="#fnref3" class="footnote-backref">↩︎</a></p></li><li id="fn4" class="footnote-item"><p>Recall the long-running Turducken Tuesdays promotion, in which turducken sandwiches are half off every Tuesday. <a href="#fnref4" class="footnote-backref">↩︎</a></p></li></ol></section>`,141),e=[p];function t(c,r,y,E,i,d){return n(),a("div",null,e)}const B=s(o,[["render",t]]);export{D as __pageData,B as default};
